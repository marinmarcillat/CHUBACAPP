<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>6. Some use cases &mdash; cloudComPy 2.12a documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="1. cloudComPy module, functions" href="cloudComPy.html" />
    <link rel="prev" title="5. operations on coordinates, scalar fields, colors, meshes with Numpy" href="userNumpy.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> cloudComPy
          </a>
              <div class="version">
                2.12
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1. cloudComPy: a first example</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">2. license</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">cloudComPy User Manual</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="userIntro.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="userLoad.html">2. Loading clouds and other entities from files</a></li>
<li class="toctree-l1"><a class="reference internal" href="userSave.html">3. Saving Clouds and other entities to files</a></li>
<li class="toctree-l1"><a class="reference internal" href="userEntities.html">4. Clouds, meshes, scalar fields: introspection, manipulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="userNumpy.html">5. operations on coordinates, scalar fields, colors, meshes with Numpy</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">6. Some use cases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#create-a-point-cloud-with-numpy">6.1. Create a point cloud with numpy</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cut-a-cloud-or-a-mesh-with-a-polyline">6.2. Cut a cloud or a mesh with a polyline</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cut-a-cloud-with-a-polyline">6.2.1. Cut a cloud with a polyline</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cut-a-mesh-with-a-polyline">6.2.2. Cut a mesh with a polyline</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#compute-distances-between-clouds-and-meshes">6.3. Compute distances between clouds and meshes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#compute-distances-between-a-cloud-and-a-mesh-c2m">6.3.1. Compute distances between a cloud and a mesh (C2M)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compute-distances-between-two-clouds-c2c">6.3.2. Compute distances between two clouds (C2C)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compute-split-distances-between-two-clouds-c2c">6.3.3. Compute split distances between two clouds (C2C)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cloud-registration">6.4. Cloud registration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cloud-registration-with-the-cloudcompare-implementation-of-icp-algorithm">6.4.1. Cloud registration with the CloudCompare implementation of ICP algorithm</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cloud-registration-with-the-pcl-plugin">6.4.2. Cloud registration with the PCL plugin</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cloud-triangulation-create-a-mesh">6.5. Cloud triangulation: create a mesh</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fitting-ccplane">6.6. Fitting ccPlane</a></li>
<li class="toctree-l2"><a class="reference internal" href="#searching-points-in-neighbourhood">6.7. Searching points in neighbourhood</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cloud-sampling-noise-filter-filter-by-scalar-field">6.8. Cloud sampling, noise filter, filter by scalar field</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#noise-filter">6.8.1. Noise filter</a></li>
<li class="toctree-l3"><a class="reference internal" href="#resample-cloud-spatially">6.8.2. Resample cloud spatially</a></li>
<li class="toctree-l3"><a class="reference internal" href="#subsample-cloud-randomly">6.8.3. Subsample cloud randomly</a></li>
<li class="toctree-l3"><a class="reference internal" href="#resample-cloud-with-octree-at-level">6.8.4. resample cloud with octree at level</a></li>
<li class="toctree-l3"><a class="reference internal" href="#resample-cloud-with-octree">6.8.5. resample cloud with octree</a></li>
<li class="toctree-l3"><a class="reference internal" href="#statistical-outliers-removal-sor-filter">6.8.6. Statistical Outliers Removal (SOR) filter</a></li>
<li class="toctree-l3"><a class="reference internal" href="#subsample-cloud-with-octree-at-level">6.8.7. subsample cloud with octree at level</a></li>
<li class="toctree-l3"><a class="reference internal" href="#subsample-cloud-with-octree">6.8.8. subsample cloud with octree</a></li>
<li class="toctree-l3"><a class="reference internal" href="#filter-by-scalar-field-values">6.8.9. filter by scalar field values</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#generate-histograms">6.9. Generate histograms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#histogram-as-a-figure">6.9.1. histogram as a figure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#histogram-as-a-csv-file">6.9.2. histogram as a csv file</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#compute-a-2-5d-volume">6.10. Compute a 2.5D volume</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cloud-rasterization">6.11. Cloud rasterization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#interpolate-scalar-fields-from-one-cloud-to-another">6.12. Interpolate scalar fields from one cloud to another</a></li>
<li class="toctree-l2"><a class="reference internal" href="#finding-an-optimal-bounding-box">6.13. Finding an optimal bounding box</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cloud-comparison-with-plugin-m3c2">6.14. Cloud comparison with plugin M3C2</a></li>
<li class="toctree-l2"><a class="reference internal" href="#shadevis-ambiant-occlusion-with-plugin-pcv">6.15. ShadeVIS (ambiant occlusion) with Plugin PCV</a></li>
<li class="toctree-l2"><a class="reference internal" href="#compute-hidden-point-removal-with-plugin-hpr">6.16. Compute Hidden Point Removal with plugin HPR</a></li>
<li class="toctree-l2"><a class="reference internal" href="#boolean-operations-on-meshes-with-plugin-meshboolean">6.17. Boolean operations on meshes with plugin MeshBoolean</a></li>
<li class="toctree-l2"><a class="reference internal" href="#finding-primitives-on-a-cloud-with-plugin-ransac-sd">6.18. Finding primitives on a cloud with plugin RANSAC-SD</a></li>
<li class="toctree-l2"><a class="reference internal" href="#compute-cloth-simulation-filter-on-a-cloud-with-csf-plugin">6.19. compute Cloth Simulation Filter on a cloud with CSF plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sclices-and-contours">6.20. Sclices and contours</a></li>
<li class="toctree-l2"><a class="reference internal" href="#extractconnectedcomponents">6.21. ExtractConnectedComponents</a></li>
<li class="toctree-l2"><a class="reference internal" href="#avoid-memory-leaks-in-an-iterative-process">6.22. Avoid memory leaks in an iterative process</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">cloudComPy Reference documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="cloudComPy.html">1. cloudComPy module, functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="ccPointCloud.html">2. Points Clouds</a></li>
<li class="toctree-l1"><a class="reference internal" href="ccPolyline.html">3. Polylines</a></li>
<li class="toctree-l1"><a class="reference internal" href="ccOctree.html">4. Octrees, descriptors and neighbourhood</a></li>
<li class="toctree-l1"><a class="reference internal" href="ccMesh.html">5. Meshes</a></li>
<li class="toctree-l1"><a class="reference internal" href="ccPrimitives.html">6. ccPrimitives</a></li>
<li class="toctree-l1"><a class="reference internal" href="ccPrimitives.html#transformations">7. transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="ccSensor.html">8. Sensor</a></li>
<li class="toctree-l1"><a class="reference internal" href="ScalarField.html">9. Scalar Fields</a></li>
<li class="toctree-l1"><a class="reference internal" href="DistanceComputationTools.html">10. Distance Computation Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="GeometricalAnalysisTools.html">11. Geometrical Analysis Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="cloudSamplingTools.html">12. Cloud Sampling Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="ccFacet.html">13. 2D Polygons</a></li>
<li class="toctree-l1"><a class="reference internal" href="Neighbourhood.html">14. Neighbourhood</a></li>
<li class="toctree-l1"><a class="reference internal" href="colors.html">15. Colors</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">plugins Reference documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="CSF.html">1. CSF plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="HPR.html">2. HPR plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="M3C2.html">3. M3C2 plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="MeshBoolean.html">4. MeshBoolean plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="PCL.html">5. PCL plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="PCV.html">6. PCV plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="RANSAC_SD.html">7. RANSAC_SD plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="MinimalBoundingBox.html">8. minimalBoundingBox Python plugin</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Indices and tables</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tables.html">1. general index</a></li>
<li class="toctree-l1"><a class="reference internal" href="tables.html#module-index">2. module index</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">cloudComPy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active"><span class="section-number">6. </span>Some use cases</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/userUseCases.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="some-use-cases">
<h1><span class="section-number">6. </span>Some use cases<a class="headerlink" href="#some-use-cases" title="Permalink to this heading"></a></h1>
<section id="create-a-point-cloud-with-numpy">
<h2><span class="section-number">6.1. </span>Create a point cloud with numpy<a class="headerlink" href="#create-a-point-cloud-with-numpy" title="Permalink to this heading"></a></h2>
<p>The way to set coordinates of a cloud from a Numpy array have been described in <a class="reference internal" href="userNumpy.html#coordinates-numpy"><span class="std std-ref">Read, modify or create cloud coordinates with Numpy</span></a>
and the method to create scalar fields from Numpy arrays have been exposed in <a class="reference internal" href="userNumpy.html#scalarfield-numpy"><span class="std std-ref">Read, modify or create a scalar field with Numpy</span></a>.</p>
<p>A first example generates a kind of spherical cloud with sinusoidal altitude fluctuations. One scalar field is defined
with the local altitude. Nodes are randomly generated.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="c1"># --- generate a set of coords and a scalar field</span>

<span class="n">npts</span> <span class="o">=</span> <span class="mi">10000000</span>
<span class="n">phi</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="n">npts</span><span class="p">))</span>
<span class="n">theta</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="n">npts</span><span class="p">))</span>
<span class="n">r</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">+</span> <span class="mf">0.3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">phi</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">theta</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span>
<span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">))</span>
<span class="n">dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="n">z</span><span class="o">*</span><span class="n">z</span><span class="p">)</span> <span class="o">-</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># --- create the pointCloud, add the scalar field</span>

<span class="n">cl</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccPointCloud</span><span class="p">(</span><span class="s2">&quot;boule&quot;</span><span class="p">)</span>
<span class="n">cl</span><span class="o">.</span><span class="n">coordsFromNPArray_copy</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
<span class="n">cl</span><span class="o">.</span><span class="n">addScalarField</span><span class="p">(</span><span class="s2">&quot;delta&quot;</span><span class="p">)</span>
<span class="n">sf</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">getScalarField</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">sf</span><span class="o">.</span><span class="n">fromNpArrayCopy</span><span class="p">(</span><span class="n">dr</span><span class="p">)</span>

<span class="c1"># --- save the point cloud</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">SavePointCloud</span><span class="p">(</span><span class="n">cl</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dataDir</span><span class="p">,</span> <span class="s2">&quot;boule.bin&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>The above code snippet is from <a class="reference download internal" download="" href="_downloads/af130132715a9038371b2974cbb24b3b/test017.py"><code class="xref download docutils literal notranslate"><span class="pre">test017.py</span></code></a>.</p>
<p>Another similar example in which we create a kind of 2.5D wavelet and add the altitude scalar field
after the cloud creation with <a class="reference internal" href="ccPointCloud.html#cloudComPy.ccPointCloud.exportCoordToSF" title="cloudComPy.ccPointCloud.exportCoordToSF"><code class="xref py py-meth docutils literal notranslate"><span class="pre">exportCoordToSF()</span></code></a>.
Nodes are randomly generated.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="c1"># --- generate a set of coords and a scalar field</span>

<span class="n">npts</span> <span class="o">=</span> <span class="mi">1000000</span>
<span class="n">h</span> <span class="o">=</span> <span class="mf">2.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="o">-</span><span class="mf">5.</span> <span class="o">+</span> <span class="mf">10.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="n">npts</span><span class="p">)))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="o">-</span><span class="mf">5.</span> <span class="o">+</span> <span class="mf">10.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="n">npts</span><span class="p">)))</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">h</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">))</span>

<span class="c1"># --- create the pointCloud</span>

<span class="n">cloud</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccPointCloud</span><span class="p">(</span><span class="s2">&quot;wave_</span><span class="si">%d</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">h</span><span class="p">)</span>
<span class="n">cloud</span><span class="o">.</span><span class="n">coordsFromNPArray_copy</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>

<span class="c1"># --- add the scalar field</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">cloud</span><span class="o">.</span><span class="n">exportCoordToSF</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>The above code snippet is from <a class="reference download internal" download="" href="_downloads/534f775bc454aa821a69886d0ba8072d/test025.py"><code class="xref download docutils literal notranslate"><span class="pre">test025.py</span></code></a>.</p>
<p>A third example draw a polyline from a bounding box obtained, for instance,
with <a class="reference internal" href="ccPointCloud.html#cloudComPy.ccPointCloud.getOwnBB" title="cloudComPy.ccPointCloud.getOwnBB"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getOwnBB()</span></code></a>.</p>
<p>Firstly, we create a Numpy array from the corner coordinates of the bounding box.
The nodes are ordered to build a polyline:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">cmin</span> <span class="o">=</span> <span class="n">boundingBox</span><span class="o">.</span><span class="n">minCorner</span><span class="p">()</span>
<span class="n">cmax</span> <span class="o">=</span> <span class="n">boundingBox</span><span class="o">.</span><span class="n">maxCorner</span><span class="p">()</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">cmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmin</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">cmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cmax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cmax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cmax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cmax</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">cmin</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cmin</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cmax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cmax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cmax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cmax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cmin</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cmin</span><span class="p">[</span><span class="mi">2</span><span class="p">])))</span>
<span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">))</span>
</pre></div>
</div>
<p>Then, we create the cloud from the Numpy array, apply a transformation, and build the polyline.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">cloud1</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccPointCloud</span><span class="p">(</span><span class="s2">&quot;boundingBox1&quot;</span><span class="p">)</span>
<span class="n">cloud1</span><span class="o">.</span><span class="n">coordsFromNPArray_copy</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
<span class="n">cloud1</span><span class="o">.</span><span class="n">applyRigidTransformation</span><span class="p">(</span><span class="n">transform1</span><span class="p">)</span>

<span class="n">poly1</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccPolyline</span><span class="p">(</span><span class="n">cloud1</span><span class="p">)</span>
<span class="n">poly1</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span><span class="n">cloud1</span><span class="p">)</span>
<span class="n">poly1</span><span class="o">.</span><span class="n">addPointIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cloud1</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
<span class="n">poly1</span><span class="o">.</span><span class="n">setClosed</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>The above code snippets are from <a class="reference download internal" download="" href="_downloads/3628ce2f1da38e8991a2453dc86334e7/test026.py"><code class="xref download docutils literal notranslate"><span class="pre">test026.py</span></code></a>.</p>
</section>
<section id="cut-a-cloud-or-a-mesh-with-a-polyline">
<span id="crop-cloud"></span><h2><span class="section-number">6.2. </span>Cut a cloud or a mesh with a polyline<a class="headerlink" href="#cut-a-cloud-or-a-mesh-with-a-polyline" title="Permalink to this heading"></a></h2>
<p>This corresponds to the CloudCompare GUI <a class="reference external" href="https://www.cloudcompare.org/doc/wiki/index.php/Interactive_Segmentation_Tool">Interactive Segmentation Tool</a>
when used with an imported polygon.</p>
<section id="cut-a-cloud-with-a-polyline">
<h3><span class="section-number">6.2.1. </span>Cut a cloud with a polyline<a class="headerlink" href="#cut-a-cloud-with-a-polyline" title="Permalink to this heading"></a></h3>
<p>The method <a class="reference internal" href="ccPointCloud.html#cloudComPy.ccPointCloud.crop2D" title="cloudComPy.ccPointCloud.crop2D"><code class="xref py py-meth docutils literal notranslate"><span class="pre">crop2D()</span></code></a> is used to cut a cloud by a 2D polyline.
The normal to the plan of the polyline can only be one of the cardinal axes oX, oY or oZ.
The original cloud is not modified, a new cloud is created with either the nodes inside or the nodes outside.</p>
<p>First step, get a cloud and the polyline tool:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">cloud</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">loadPointCloud</span><span class="p">(</span><span class="n">getSampleCloud</span><span class="p">(</span><span class="mf">5.0</span><span class="p">))</span>
<span class="n">poly</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">loadPolyline</span><span class="p">(</span><span class="n">getSamplePoly</span><span class="p">(</span><span class="s2">&quot;poly1&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>Second step, close the polyline:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">poly</span><span class="o">.</span><span class="n">setClosed</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Third step, cut:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">cloudCropZ</span> <span class="o">=</span> <span class="n">cloud</span><span class="o">.</span><span class="n">crop2D</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>The above code snippets are from <a class="reference download internal" download="" href="_downloads/e6c8880e2eb96f3c4f6fa753202fb3d4/test007.py"><code class="xref download docutils literal notranslate"><span class="pre">test007.py</span></code></a>.</p>
</section>
<section id="cut-a-mesh-with-a-polyline">
<h3><span class="section-number">6.2.2. </span>Cut a mesh with a polyline<a class="headerlink" href="#cut-a-mesh-with-a-polyline" title="Permalink to this heading"></a></h3>
<p>As with the cloud, the method <a class="reference internal" href="ccMesh.html#cloudComPy.ccMesh.crop2D" title="cloudComPy.ccMesh.crop2D"><code class="xref py py-meth docutils literal notranslate"><span class="pre">crop2D()</span></code></a> is used to cut a mesh by a 2D polyline.
The normal to the plan of the polyline can only be one of the cardinal axes oX, oY or oZ.
The original mesh is not modified, a new mesh is created with either the triangles inside or the triangles outside.</p>
<p>In this example, scalar fields and normals are defined, to check they are kept in the result.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">cloud1</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">loadPointCloud</span><span class="p">(</span><span class="n">getSampleCloud2</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span>
<span class="n">cloud1</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">&quot;cloud1&quot;</span><span class="p">)</span>
<span class="n">cloud1</span><span class="o">.</span><span class="n">exportCoordToSF</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">mesh1</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccMesh</span><span class="o">.</span><span class="n">triangulate</span><span class="p">(</span><span class="n">cloud1</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">TRIANGULATION_TYPES</span><span class="o">.</span><span class="n">DELAUNAY_2D_AXIS_ALIGNED</span><span class="p">)</span>
<span class="n">mesh1</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">&quot;mesh1&quot;</span><span class="p">)</span>
<span class="n">cc</span><span class="o">.</span><span class="n">computeNormals</span><span class="p">([</span><span class="n">mesh1</span><span class="p">],</span> <span class="n">computePerVertexNormals</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">poly</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">loadPolyline</span><span class="p">(</span><span class="n">getSamplePoly</span><span class="p">(</span><span class="s2">&quot;poly1&quot;</span><span class="p">))</span>
<span class="n">meshCropZ</span> <span class="o">=</span> <span class="n">mesh1</span><span class="o">.</span><span class="n">crop2D</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>The above code snippet is from <a class="reference download internal" download="" href="_downloads/9c84438d1100733b12da25a34d33f12b/test039.py"><code class="xref download docutils literal notranslate"><span class="pre">test039.py</span></code></a>.</p>
</section>
</section>
<section id="compute-distances-between-clouds-and-meshes">
<h2><span class="section-number">6.3. </span>Compute distances between clouds and meshes<a class="headerlink" href="#compute-distances-between-clouds-and-meshes" title="Permalink to this heading"></a></h2>
<p>The idea is to build a scalarField giving, for each node in a cloud,
the distance between this node and another cloud or mesh.
The process can be long, several tools help to find an optimal set of parameters.</p>
<p>The <a class="reference external" href="https://www.cloudcompare.org/doc/wiki/index.php/Main_Page">CloudCompare wiki</a> provides a good introduction to
the <a class="reference external" href="https://www.cloudcompare.org/doc/wiki/index.php/Distances_Computation">distances computation</a>.</p>
<p>See also :ref: <cite>cloud_comparison_M3C2</cite>.</p>
<section id="compute-distances-between-a-cloud-and-a-mesh-c2m">
<h3><span class="section-number">6.3.1. </span>Compute distances between a cloud and a mesh (C2M)<a class="headerlink" href="#compute-distances-between-a-cloud-and-a-mesh-c2m" title="Permalink to this heading"></a></h3>
<p>The method <a class="reference internal" href="DistanceComputationTools.html#cloudComPy.DistanceComputationTools.computeApproxCloud2MeshDistance" title="cloudComPy.DistanceComputationTools.computeApproxCloud2MeshDistance"><code class="xref py py-meth docutils literal notranslate"><span class="pre">cloudComPy.DistanceComputationTools.computeApproxCloud2MeshDistance()</span></code></a>
gives an approximate solution, without too much cpu time. You get an approximate distance scalar field,
and statistics (min, max, mean, variance, error max).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">stats</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">DistanceComputationTools</span><span class="o">.</span><span class="n">computeApproxCloud2MeshDistance</span><span class="p">(</span><span class="n">cloud</span><span class="p">,</span> <span class="n">cylinder</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span> <span class="c1"># min, max, mean, variance, error max</span>
</pre></div>
</div>
<p>The structure <a class="reference internal" href="DistanceComputationTools.html#cloudComPy.Cloud2MeshDistancesComputationParams" title="cloudComPy.Cloud2MeshDistancesComputationParams"><code class="xref py py-meth docutils literal notranslate"><span class="pre">cloudComPy.Cloud2MeshDistancesComputationParams()</span></code></a>
is used to define the optimal parameters for accurate distance calculation.
For instance, if the cloud and mesh are close, filling the parameter <code class="docutils literal notranslate"><span class="pre">maxSearchDist</span></code> can greatly speed up the process,
but setting it to a non-zero value force a single thread processing.
The result is a new scalar field in the cloud, with accurate distances to the mesh.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">nbCpu</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
<span class="n">bestOctreeLevel</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">DistanceComputationTools</span><span class="o">.</span><span class="n">determineBestOctreeLevel</span><span class="p">(</span><span class="n">cloud</span><span class="p">,</span><span class="n">cylinder</span><span class="p">)</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">Cloud2MeshDistancesComputationParams</span><span class="p">()</span>
<span class="n">params</span><span class="o">.</span><span class="n">maxThreadCount</span> <span class="o">=</span> <span class="n">nbCpu</span>
<span class="n">params</span><span class="o">.</span><span class="n">octreeLevel</span> <span class="o">=</span> <span class="n">bestOctreeLevel</span>
<span class="n">cc</span><span class="o">.</span><span class="n">DistanceComputationTools</span><span class="o">.</span><span class="n">computeCloud2MeshDistances</span><span class="p">(</span><span class="n">cloud</span><span class="p">,</span> <span class="n">cylinder</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
<p>The above code snippet is from <a class="reference download internal" download="" href="_downloads/096775a56e6827f9b68a334890bdf7c2/test009.py"><code class="xref download docutils literal notranslate"><span class="pre">test009.py</span></code></a>.</p>
</section>
<section id="compute-distances-between-two-clouds-c2c">
<span id="compute-c2c"></span><h3><span class="section-number">6.3.2. </span>Compute distances between two clouds (C2C)<a class="headerlink" href="#compute-distances-between-two-clouds-c2c" title="Permalink to this heading"></a></h3>
<p>The method <a class="reference internal" href="DistanceComputationTools.html#cloudComPy.DistanceComputationTools.computeApproxCloud2CloudDistance" title="cloudComPy.DistanceComputationTools.computeApproxCloud2CloudDistance"><code class="xref py py-meth docutils literal notranslate"><span class="pre">cloudComPy.DistanceComputationTools.computeApproxCloud2CloudDistance()</span></code></a>
gives an approximate solution, without too much cpu time. You get an approximate distance scalar field,
and statistics (min, max, mean, variance, error max).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">stats</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">DistanceComputationTools</span><span class="o">.</span><span class="n">computeApproxCloud2CloudDistance</span><span class="p">(</span><span class="n">cloud2ref</span><span class="p">,</span> <span class="n">cloud3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span> <span class="c1"># min, max, mean, variance, error max</span>
</pre></div>
</div>
<p>The structure <a class="reference internal" href="DistanceComputationTools.html#cloudComPy.Cloud2CloudDistancesComputationParams" title="cloudComPy.Cloud2CloudDistancesComputationParams"><code class="xref py py-meth docutils literal notranslate"><span class="pre">cloudComPy.Cloud2CloudDistancesComputationParams()</span></code></a>
is used to define the optimal parameters for accurate distance calculation.
For instance, if the two clouds are close, filling the parameter <code class="docutils literal notranslate"><span class="pre">maxSearchDist</span></code> can greatly speed up the process,
but setting it to a non-zero value force a single thread processing.
The result is a new scalar field in the cloud, with accurate distances to the cloud.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">nbCpu</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
<span class="n">bestOctreeLevel</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">DistanceComputationTools</span><span class="o">.</span><span class="n">determineBestOctreeLevel</span><span class="p">(</span><span class="n">cloud2ref</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cloud3</span><span class="p">)</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">Cloud2CloudDistancesComputationParams</span><span class="p">()</span>
<span class="n">params</span><span class="o">.</span><span class="n">maxThreadCount</span> <span class="o">=</span> <span class="n">nbCpu</span>
<span class="n">params</span><span class="o">.</span><span class="n">octreeLevel</span> <span class="o">=</span> <span class="n">bestOctreeLevel</span>
<span class="n">cc</span><span class="o">.</span><span class="n">DistanceComputationTools</span><span class="o">.</span><span class="n">computeCloud2CloudDistances</span><span class="p">(</span><span class="n">cloud2ref</span><span class="p">,</span> <span class="n">cloud3</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
<p>The above code snippet is from <a class="reference download internal" download="" href="_downloads/3f478a9365e7abb3b3180b40eb05c907/test010.py"><code class="xref download docutils literal notranslate"><span class="pre">test010.py</span></code></a>.</p>
</section>
<section id="compute-split-distances-between-two-clouds-c2c">
<h3><span class="section-number">6.3.3. </span>Compute split distances between two clouds (C2C)<a class="headerlink" href="#compute-split-distances-between-two-clouds-c2c" title="Permalink to this heading"></a></h3>
<p>The use case is similar to <a class="reference internal" href="#compute-c2c"><span class="std std-ref">Compute distances between two clouds (C2C)</span></a>
but we need to split the distance components according to the cardinal directions.
Here, we set the parameter <code class="docutils literal notranslate"><span class="pre">setSplitDistances</span></code> to <cite>cloud.size()</cite> to create 3 scalar fields of the cloud size.
They are not associated to the cloud, this will be done when the distances are computed.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">stats</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">DistanceComputationTools</span><span class="o">.</span><span class="n">computeApproxCloud2CloudDistance</span><span class="p">(</span><span class="n">cloud</span><span class="p">,</span>
                                               <span class="n">cylinder</span><span class="o">.</span><span class="n">getAssociatedCloud</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span> <span class="c1"># min, max, mean, variance, error max</span>

<span class="n">nbCpu</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
<span class="n">bestOctreeLevel</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">DistanceComputationTools</span><span class="o">.</span><span class="n">determineBestOctreeLevel</span><span class="p">(</span><span class="n">cloud</span><span class="p">,</span>
                                          <span class="kc">None</span><span class="p">,</span> <span class="n">cylinder</span><span class="o">.</span><span class="n">getAssociatedCloud</span><span class="p">())</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">Cloud2CloudDistancesComputationParams</span><span class="p">()</span>
<span class="n">params</span><span class="o">.</span><span class="n">maxThreadCount</span> <span class="o">=</span> <span class="n">nbCpu</span>
<span class="n">params</span><span class="o">.</span><span class="n">octreeLevel</span> <span class="o">=</span> <span class="n">bestOctreeLevel</span>
<span class="n">params</span><span class="o">.</span><span class="n">setSplitDistances</span><span class="p">(</span><span class="n">cloud</span><span class="o">.</span><span class="n">size</span><span class="p">())</span> <span class="c1"># creates 3 scalar fields of cloud.size()</span>
                                       <span class="c1"># associated to the cloud on compute</span>

<span class="n">cc</span><span class="o">.</span><span class="n">DistanceComputationTools</span><span class="o">.</span><span class="n">computeCloud2CloudDistances</span><span class="p">(</span><span class="n">cloud</span><span class="p">,</span> 
                                 <span class="n">cylinder</span><span class="o">.</span><span class="n">getAssociatedCloud</span><span class="p">(),</span> <span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
<p>The cloud contains four new scalar fields:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">C2C</span> <span class="pre">absolute</span> <span class="pre">distances</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">C2C</span> <span class="pre">absolute</span> <span class="pre">distances</span> <span class="pre">(X)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">C2C</span> <span class="pre">absolute</span> <span class="pre">distances</span> <span class="pre">(Y)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">C2C</span> <span class="pre">absolute</span> <span class="pre">distances</span> <span class="pre">(Z)</span></code></p></li>
</ul>
</div></blockquote>
<p>The above code snippet is from <a class="reference download internal" download="" href="_downloads/096775a56e6827f9b68a334890bdf7c2/test009.py"><code class="xref download docutils literal notranslate"><span class="pre">test009.py</span></code></a>.</p>
</section>
</section>
<section id="cloud-registration">
<h2><span class="section-number">6.4. </span>Cloud registration<a class="headerlink" href="#cloud-registration" title="Permalink to this heading"></a></h2>
<section id="cloud-registration-with-the-cloudcompare-implementation-of-icp-algorithm">
<h3><span class="section-number">6.4.1. </span>Cloud registration with the CloudCompare implementation of ICP algorithm<a class="headerlink" href="#cloud-registration-with-the-cloudcompare-implementation-of-icp-algorithm" title="Permalink to this heading"></a></h3>
<p>The <a class="reference external" href="https://www.cloudcompare.org/doc/wiki/index.php/Main_Page">CloudCompare wiki</a> provides a good introduction to
the <a class="reference external" href="https://www.cloudcompare.org/doc/wiki/index.php/Alignment_and_Registration">alignment and registration process</a>.</p>
<p>To test the registration with ICP (iterative ClosestPoint) we get two clouds with an exact overlap of 10% and
we apply a small rotation-translation on one cloud.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">cloud1</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">loadPointCloud</span><span class="p">(</span><span class="n">getSampleCloud</span><span class="p">(</span><span class="mf">5.0</span><span class="p">))</span>
<span class="n">cloud1</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">&quot;cloud1&quot;</span><span class="p">)</span>

<span class="n">cloud2ref</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">loadPointCloud</span><span class="p">(</span><span class="n">getSampleCloud</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">))</span>
<span class="n">cloud2ref</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">&quot;cloud2_reference&quot;</span><span class="p">)</span>

<span class="n">cloud2</span> <span class="o">=</span> <span class="n">cloud2ref</span><span class="o">.</span><span class="n">cloneThis</span><span class="p">()</span>
<span class="n">tr1</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccGLMatrix</span><span class="p">()</span>
<span class="c1"># --------------------  z -- y -- x  (rotation x 0.1, translation z 0.3)</span>
<span class="n">tr1</span><span class="o">.</span><span class="n">initFromParameters</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">))</span>
<span class="n">cloud2</span><span class="o">.</span><span class="n">applyRigidTransformation</span><span class="p">(</span><span class="n">tr1</span><span class="p">)</span>
<span class="n">cloud2</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">&quot;cloud2_transformed&quot;</span><span class="p">)</span>

<span class="n">cc</span><span class="o">.</span><span class="n">SaveEntities</span><span class="p">([</span><span class="n">cloud1</span><span class="p">,</span> <span class="n">cloud2ref</span><span class="p">,</span> <span class="n">cloud2</span><span class="p">],</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dataDir</span><span class="p">,</span> <span class="s2">&quot;clouds2.bin&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>Then we apply the ICP algorithm <a class="reference internal" href="cloudComPy.html#cloudComPy.ICP" title="cloudComPy.ICP"><code class="xref py py-meth docutils literal notranslate"><span class="pre">cloudComPy.ICP()</span></code></a> which gives a transformation to apply
to get the precise overlap of the clouds.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">res</span><span class="o">=</span><span class="n">cc</span><span class="o">.</span><span class="n">ICP</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">cloud2</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">cloud1</span><span class="p">,</span> <span class="n">minRMSDecrease</span><span class="o">=</span><span class="mf">1.e-5</span><span class="p">,</span>
           <span class="n">maxIterationCount</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">randomSamplingLimit</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span> <span class="n">removeFarthestPoints</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
           <span class="n">method</span><span class="o">=</span><span class="n">cc</span><span class="o">.</span><span class="n">CONVERGENCE_TYPE</span><span class="o">.</span><span class="n">MAX_ITER_CONVERGENCE</span><span class="p">,</span>
           <span class="n">adjustScale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">finalOverlapRatio</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">tr2</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">transMat</span>
<span class="n">cloud3</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">aligned</span>
<span class="n">cloud3</span><span class="o">.</span><span class="n">applyRigidTransformation</span><span class="p">(</span><span class="n">tr2</span><span class="p">)</span>
<span class="n">cloud3</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">&quot;cloud2_transformed_afterICP&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The above code snippets are from <a class="reference download internal" download="" href="_downloads/3f478a9365e7abb3b3180b40eb05c907/test010.py"><code class="xref download docutils literal notranslate"><span class="pre">test010.py</span></code></a>.</p>
</section>
<section id="cloud-registration-with-the-pcl-plugin">
<h3><span class="section-number">6.4.2. </span>Cloud registration with the PCL plugin<a class="headerlink" href="#cloud-registration-with-the-pcl-plugin" title="Permalink to this heading"></a></h3>
<p>The <a class="reference external" href="http://www.cloudcompare.org/doc/wiki/index.php/Point_Cloud_Library_Wrapper_(plugin)">PCL plugin</a>
of CloudCompare wraps several methods of the <a class="reference external" href="https://pointclouds.org/">PCL Library</a>.
The <a class="reference external" href="http://www.cloudcompare.org/doc/wiki/index.php/Fast_Global_Registration">Fast Global Registration</a>
is one of these methods.</p>
<p>To test this tool, we start by cloning a cloud and applying a rotation on it.
The algorithm requires to compute normals on clouds.
We keep clones of the clouds for testing purposes.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">cloud1</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">loadPointCloud</span><span class="p">(</span><span class="n">getSampleCloud2</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span>

<span class="n">cloud2</span> <span class="o">=</span> <span class="n">cloud1</span><span class="o">.</span><span class="n">cloneThis</span><span class="p">()</span>
<span class="n">tr1</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccGLMatrix</span><span class="p">()</span>
<span class="n">tr1</span><span class="o">.</span><span class="n">initFromParameters</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">))</span>
<span class="n">cloud2</span><span class="o">.</span><span class="n">applyRigidTransformation</span><span class="p">(</span><span class="n">tr1</span><span class="p">)</span>

<span class="n">cc</span><span class="o">.</span><span class="n">computeNormals</span><span class="p">([</span><span class="n">cloud1</span><span class="p">,</span> <span class="n">cloud2</span><span class="p">])</span>

<span class="n">cloud2ref</span> <span class="o">=</span> <span class="n">cloud2</span><span class="o">.</span><span class="n">cloneThis</span><span class="p">()</span>
<span class="n">cloud2bis</span> <span class="o">=</span> <span class="n">cloud2ref</span><span class="o">.</span><span class="n">cloneThis</span><span class="p">()</span>
</pre></div>
</div>
<p>We need to import the <a class="reference internal" href="PCL.html#module-cloudComPy.PCL" title="cloudComPy.PCL"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PCL</span></code></a> plugin:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="k">if</span> <span class="n">cc</span><span class="o">.</span><span class="n">isPluginPCL</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">cloudComPy.PCL</span>
    
</pre></div>
</div>
<p>The <a class="reference internal" href="PCL.html#module-cloudComPy.PCL" title="cloudComPy.PCL"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PCL</span></code></a> plugin gives access to the class <a class="reference internal" href="PCL.html#cloudComPy.PCL.FastGlobalRegistrationFilter" title="cloudComPy.PCL.FastGlobalRegistrationFilter"><code class="xref py py-class docutils literal notranslate"><span class="pre">FastGlobalRegistrationFilter</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
    <span class="n">fpcl</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">PCL</span><span class="o">.</span><span class="n">FastGlobalRegistrationFilter</span><span class="p">()</span>
    <span class="n">fpcl</span><span class="o">.</span><span class="n">setParameters</span><span class="p">(</span><span class="n">cloud1</span><span class="p">,</span> <span class="p">[</span><span class="n">cloud2</span><span class="p">])</span>
    <span class="n">res</span><span class="o">=</span><span class="n">fpcl</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
    
</pre></div>
</div>
<p>The above code snippets are from <a class="reference download internal" download="" href="_downloads/5cd6358c36e74d05b8c7a505f392e043/test038.py"><code class="xref download docutils literal notranslate"><span class="pre">test038.py</span></code></a>.</p>
</section>
</section>
<section id="cloud-triangulation-create-a-mesh">
<h2><span class="section-number">6.5. </span>Cloud triangulation: create a mesh<a class="headerlink" href="#cloud-triangulation-create-a-mesh" title="Permalink to this heading"></a></h2>
<p>The <a class="reference internal" href="ccMesh.html#cloudComPy.ccMesh.triangulate" title="cloudComPy.ccMesh.triangulate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">cloudComPy.ccMesh.triangulate()</span></code></a> methods is adapted to create
a Delaunay 2.5D mesh from a point cloud that represents a kind of 2.5D elevated surface.</p>
<p>When the best fitting plane of the cloud is axis aligned (dim=2 means Z axis):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">cloud1</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">loadPointCloud</span><span class="p">(</span><span class="n">getSampleCloud2</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span>
<span class="n">cloud1</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">&quot;cloud1&quot;</span><span class="p">)</span>

<span class="n">mesh1</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccMesh</span><span class="o">.</span><span class="n">triangulate</span><span class="p">(</span><span class="n">cloud1</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">TRIANGULATION_TYPES</span><span class="o">.</span><span class="n">DELAUNAY_2D_AXIS_ALIGNED</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">mesh1</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">&quot;mesh1&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Otherwise we tell the algorithm to find the best fitting plane:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">cloud2</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">loadPointCloud</span><span class="p">(</span><span class="n">getSampleCloud2</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span>
<span class="n">cloud2</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">&quot;cloud2&quot;</span><span class="p">)</span>
<span class="n">tr1</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccGLMatrix</span><span class="p">()</span>
<span class="n">tr1</span><span class="o">.</span><span class="n">initFromParameters</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">))</span>
<span class="n">cloud2</span><span class="o">.</span><span class="n">applyRigidTransformation</span><span class="p">(</span><span class="n">tr1</span><span class="p">)</span>

<span class="n">mesh4</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccMesh</span><span class="o">.</span><span class="n">triangulate</span><span class="p">(</span><span class="n">cloud2</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">TRIANGULATION_TYPES</span><span class="o">.</span><span class="n">DELAUNAY_2D_BEST_LS_PLANE</span><span class="p">)</span>
<span class="n">mesh4</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">&quot;mesh4&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The above code snippets are from <a class="reference download internal" download="" href="_downloads/0accd3e5963f0da959e6810677fc905f/test011.py"><code class="xref download docutils literal notranslate"><span class="pre">test011.py</span></code></a>.</p>
</section>
<section id="fitting-ccplane">
<h2><span class="section-number">6.6. </span>Fitting ccPlane<a class="headerlink" href="#fitting-ccplane" title="Permalink to this heading"></a></h2>
<p>The method <a class="reference internal" href="ccPrimitives.html#cloudComPy.ccPlane.Fit" title="cloudComPy.ccPlane.Fit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Fit()</span></code></a> allows to adjust a plane primitive on a cloud.
The method <a class="reference internal" href="ccPrimitives.html#cloudComPy.ccPlane.getEquation" title="cloudComPy.ccPlane.getEquation"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getEquation()</span></code></a> gives the 4 coefficients of the plane ([a, b, c, d] as ax+by+cz=d):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">cloud1</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">loadPointCloud</span><span class="p">(</span><span class="n">getSampleCloud2</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span>
<span class="n">cloud1</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">&quot;cloud1&quot;</span><span class="p">)</span>
<span class="n">tr1</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccGLMatrix</span><span class="p">()</span>
<span class="n">tr1</span><span class="o">.</span><span class="n">initFromParameters</span><span class="p">(</span><span class="mf">0.2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">))</span>
<span class="n">cloud1</span><span class="o">.</span><span class="n">applyRigidTransformation</span><span class="p">(</span><span class="n">tr1</span><span class="p">)</span>

<span class="n">plane</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccPlane</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">cloud1</span><span class="p">)</span>
<span class="n">equation</span> <span class="o">=</span> <span class="n">plane</span><span class="o">.</span><span class="n">getEquation</span><span class="p">()</span>
<span class="n">tr2</span> <span class="o">=</span> <span class="n">plane</span><span class="o">.</span><span class="n">getTransformation</span><span class="p">()</span>
</pre></div>
</div>
<p>The above code snippet is from <a class="reference download internal" download="" href="_downloads/17fbf262a54ff651b642fda52dd02948/test012.py"><code class="xref download docutils literal notranslate"><span class="pre">test012.py</span></code></a>.</p>
<p>See <a class="reference internal" href="userEntities.html#plane-properties"><span class="std std-ref">Plane</span></a> for the plane methods.</p>
<p>See also <a class="reference internal" href="userEntities.html#d-polygons"><span class="std std-ref">2D polygons (facets)</span></a> if you want the 2D polygon delimiting the projection of the cloud on the fitting plane.</p>
</section>
<section id="searching-points-in-neighbourhood">
<h2><span class="section-number">6.7. </span>Searching points in neighbourhood<a class="headerlink" href="#searching-points-in-neighbourhood" title="Permalink to this heading"></a></h2>
<p>To find cloud nodes in the neighbourhood of a given point, the octree offers several methods,
to search in a sphere, a cylinder, a box. See <a class="reference internal" href="userEntities.html#octrees"><span class="std std-ref">octrees</span></a> for examples of use.</p>
</section>
<section id="cloud-sampling-noise-filter-filter-by-scalar-field">
<h2><span class="section-number">6.8. </span>Cloud sampling, noise filter, filter by scalar field<a class="headerlink" href="#cloud-sampling-noise-filter-filter-by-scalar-field" title="Permalink to this heading"></a></h2>
<p>The class <a class="reference internal" href="cloudSamplingTools.html#cloudComPy.CloudSamplingTools" title="cloudComPy.CloudSamplingTools"><code class="xref py py-class docutils literal notranslate"><span class="pre">cloudComPy.CloudSamplingTools</span></code></a> offers several cloud sampling filters.</p>
<section id="noise-filter">
<h3><span class="section-number">6.8.1. </span>Noise filter<a class="headerlink" href="#noise-filter" title="Permalink to this heading"></a></h3>
<p>The <a class="reference internal" href="cloudSamplingTools.html#cloudComPy.CloudSamplingTools.noiseFilter" title="cloudComPy.CloudSamplingTools.noiseFilter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">noiseFilter()</span></code></a> method
is based on the distance to the approximate local surface.
This filter removes points based on their distance relatively to the best fit plane computed on their neighbors.</p>
<p>The mandatory parameters are the cloud, the neighbourhood radius and the number of sigmas:</p>
<p>The result is a selection (<a class="reference internal" href="ccPointCloud.html#cloudComPy.ReferenceCloud" title="cloudComPy.ReferenceCloud"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReferenceCloud</span></code></a>)
that must be transformed in <a class="reference internal" href="ccPointCloud.html#cloudComPy.ccPointCloud" title="cloudComPy.ccPointCloud"><code class="xref py py-class docutils literal notranslate"><span class="pre">ccPointCloud</span></code></a> with <a class="reference internal" href="ccPointCloud.html#cloudComPy.ccPointCloud.partialClone" title="cloudComPy.ccPointCloud.partialClone"><code class="xref py py-meth docutils literal notranslate"><span class="pre">partialClone()</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">cloud</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">loadPointCloud</span><span class="p">(</span><span class="n">getSampleCloud</span><span class="p">(</span><span class="mf">5.0</span><span class="p">))</span>

<span class="n">refCloud</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">CloudSamplingTools</span><span class="o">.</span><span class="n">noiseFilter</span><span class="p">(</span><span class="n">cloud</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="c1"># selection on cloud</span>
<span class="n">origCloud</span> <span class="o">=</span> <span class="n">refCloud</span><span class="o">.</span><span class="n">getAssociatedCloud</span><span class="p">()</span>            <span class="c1"># the original cloud ~ cloud</span>
<span class="p">(</span><span class="n">noiseCloud</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span> <span class="o">=</span> <span class="n">origCloud</span><span class="o">.</span><span class="n">partialClone</span><span class="p">(</span><span class="n">refCloud</span><span class="p">)</span> <span class="c1"># ccPointCloud from selection, status</span>
<span class="n">noiseCloud</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">&quot;noiseCloud&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">refCloud</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">!=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ReferenceCloud</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
<span class="k">if</span> <span class="n">refCloud</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">7489</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
<span class="k">if</span> <span class="n">res</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
</pre></div>
</div>
</section>
<section id="resample-cloud-spatially">
<h3><span class="section-number">6.8.2. </span>Resample cloud spatially<a class="headerlink" href="#resample-cloud-spatially" title="Permalink to this heading"></a></h3>
<p>The <a class="reference internal" href="cloudSamplingTools.html#cloudComPy.CloudSamplingTools.resampleCloudSpatially" title="cloudComPy.CloudSamplingTools.resampleCloudSpatially"><code class="xref py py-meth docutils literal notranslate"><span class="pre">resampleCloudSpatially()</span></code></a> method
resamples a point cloud (process based on inter point distance)
The cloud is resampled so that there is no point nearer than a given distance to other points.
It works by picking a reference point, removing all points which are to close to this point,
and repeating these two steps until the result is reached.</p>
<p>The mandatory parameters are the cloud and the distance.</p>
<p>The result is a selection (<a class="reference internal" href="ccPointCloud.html#cloudComPy.ReferenceCloud" title="cloudComPy.ReferenceCloud"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReferenceCloud</span></code></a>)
that must be transformed in <a class="reference internal" href="ccPointCloud.html#cloudComPy.ccPointCloud" title="cloudComPy.ccPointCloud"><code class="xref py py-class docutils literal notranslate"><span class="pre">ccPointCloud</span></code></a> with <a class="reference internal" href="ccPointCloud.html#cloudComPy.ccPointCloud.partialClone" title="cloudComPy.ccPointCloud.partialClone"><code class="xref py py-meth docutils literal notranslate"><span class="pre">partialClone()</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">params</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">SFModulationParams</span><span class="p">()</span>
<span class="n">refCloud</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">CloudSamplingTools</span><span class="o">.</span><span class="n">resampleCloudSpatially</span><span class="p">(</span><span class="n">cloud</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
<span class="p">(</span><span class="n">spatialCloud</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span> <span class="o">=</span> <span class="n">cloud</span><span class="o">.</span><span class="n">partialClone</span><span class="p">(</span><span class="n">refCloud</span><span class="p">)</span>
<span class="n">spatialCloud</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">&quot;spatialCloud&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">refCloud</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">55465</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
<span class="k">if</span> <span class="n">res</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
</pre></div>
</div>
</section>
<section id="subsample-cloud-randomly">
<h3><span class="section-number">6.8.3. </span>Subsample cloud randomly<a class="headerlink" href="#subsample-cloud-randomly" title="Permalink to this heading"></a></h3>
<p>The <a class="reference internal" href="cloudSamplingTools.html#cloudComPy.CloudSamplingTools.subsampleCloudRandomly" title="cloudComPy.CloudSamplingTools.subsampleCloudRandomly"><code class="xref py py-meth docutils literal notranslate"><span class="pre">subsampleCloudRandomly()</span></code></a> method
subsamples a point cloud (process based on random selections).
This is a very simple subsampling algorithm that simply consists in selecting “n” different points, in a random way.</p>
<p>The mandatory parameters are the cloud and the total number of points to keep.</p>
<p>The result is a selection (<a class="reference internal" href="ccPointCloud.html#cloudComPy.ReferenceCloud" title="cloudComPy.ReferenceCloud"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReferenceCloud</span></code></a>)
that must be transformed in <a class="reference internal" href="ccPointCloud.html#cloudComPy.ccPointCloud" title="cloudComPy.ccPointCloud"><code class="xref py py-class docutils literal notranslate"><span class="pre">ccPointCloud</span></code></a> with <a class="reference internal" href="ccPointCloud.html#cloudComPy.ccPointCloud.partialClone" title="cloudComPy.ccPointCloud.partialClone"><code class="xref py py-meth docutils literal notranslate"><span class="pre">partialClone()</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">refCloud</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">CloudSamplingTools</span><span class="o">.</span><span class="n">subsampleCloudRandomly</span><span class="p">(</span><span class="n">cloud</span><span class="p">,</span> <span class="mi">50000</span><span class="p">)</span>
<span class="p">(</span><span class="n">randomCloud</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span> <span class="o">=</span> <span class="n">cloud</span><span class="o">.</span><span class="n">partialClone</span><span class="p">(</span><span class="n">refCloud</span><span class="p">)</span>
<span class="n">randomCloud</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">&quot;randomCloud&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">refCloud</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">50000</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
<span class="k">if</span> <span class="n">res</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
</pre></div>
</div>
</section>
<section id="resample-cloud-with-octree-at-level">
<h3><span class="section-number">6.8.4. </span>resample cloud with octree at level<a class="headerlink" href="#resample-cloud-with-octree-at-level" title="Permalink to this heading"></a></h3>
<p>The <a class="reference internal" href="cloudSamplingTools.html#cloudComPy.CloudSamplingTools.resampleCloudWithOctreeAtLevel" title="cloudComPy.CloudSamplingTools.resampleCloudWithOctreeAtLevel"><code class="xref py py-meth docutils literal notranslate"><span class="pre">resampleCloudWithOctreeAtLevel()</span></code></a> method
is a resampling algorithm is applied inside each cell of the octree.
The different resampling methods are represented as an enumerator (see <a class="reference internal" href="cloudSamplingTools.html#cloudComPy.RESAMPLING_CELL_METHOD" title="cloudComPy.RESAMPLING_CELL_METHOD"><code class="xref py py-class docutils literal notranslate"><span class="pre">RESAMPLING_CELL_METHOD</span></code></a>)
and consist in simple processes such as replacing all the points lying in a cell by the cell center
or by the points gravity center.</p>
<p>The mandatory parameters are the cloud, the octree level and the resampling method.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">resOctrAlCloud</span>  <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">CloudSamplingTools</span><span class="o">.</span><span class="n">resampleCloudWithOctreeAtLevel</span><span class="p">(</span><span class="n">randomCloud</span><span class="p">,</span> <span class="n">octreeLevel</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                         <span class="n">resamplingMethod</span><span class="o">=</span><span class="n">cc</span><span class="o">.</span><span class="n">RESAMPLING_CELL_METHOD</span><span class="o">.</span><span class="n">CELL_CENTER</span><span class="p">)</span>
<span class="n">resOctrAlCloud</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">&quot;resOctrAlCloud&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">resOctrAlCloud</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">2050</span> <span class="ow">or</span> <span class="n">resOctrAlCloud</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">2100</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
</pre></div>
</div>
</section>
<section id="resample-cloud-with-octree">
<h3><span class="section-number">6.8.5. </span>resample cloud with octree<a class="headerlink" href="#resample-cloud-with-octree" title="Permalink to this heading"></a></h3>
<p>The <a class="reference internal" href="cloudSamplingTools.html#cloudComPy.CloudSamplingTools.resampleCloudWithOctree" title="cloudComPy.CloudSamplingTools.resampleCloudWithOctree"><code class="xref py py-meth docutils literal notranslate"><span class="pre">resampleCloudWithOctree()</span></code></a> method
is the same as <a class="reference internal" href="cloudSamplingTools.html#cloudComPy.CloudSamplingTools.resampleCloudWithOctreeAtLevel" title="cloudComPy.CloudSamplingTools.resampleCloudWithOctreeAtLevel"><code class="xref py py-meth docutils literal notranslate"><span class="pre">resampleCloudWithOctreeAtLevel()</span></code></a> method,
apart the fact that instead of giving a specific octree subdivision level as input parameter,
one can specify an approximative number of points for the resulting cloud
(the algorithm will automatically determine the corresponding octree level).</p>
<p>The mandatory parameters are the cloud, the approximate number of points and the resampling method.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">resOctrCloud</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">CloudSamplingTools</span><span class="o">.</span><span class="n">resampleCloudWithOctree</span><span class="p">(</span><span class="n">randomCloud</span><span class="p">,</span> <span class="n">newNumberOfPoints</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
                                         <span class="n">resamplingMethod</span><span class="o">=</span><span class="n">cc</span><span class="o">.</span><span class="n">RESAMPLING_CELL_METHOD</span><span class="o">.</span><span class="n">CELL_CENTER</span><span class="p">)</span>
<span class="n">resOctrCloud</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">&quot;resOctrCloud&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">resOctrCloud</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">1900</span> <span class="ow">or</span> <span class="n">resOctrCloud</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">8000</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
</pre></div>
</div>
</section>
<section id="statistical-outliers-removal-sor-filter">
<h3><span class="section-number">6.8.6. </span>Statistical Outliers Removal (SOR) filter<a class="headerlink" href="#statistical-outliers-removal-sor-filter" title="Permalink to this heading"></a></h3>
<p>The <a class="reference internal" href="cloudSamplingTools.html#cloudComPy.CloudSamplingTools.sorFilter" title="cloudComPy.CloudSamplingTools.sorFilter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sorFilter()</span></code></a> method
removes points based on their mean distance to their distance
(by comparing it to the average distance of all points to their neighbors).
It is equivalent to <a class="reference external" href="https://pointclouds.org/">PCL Library</a>
<a class="reference external" href="https://pointclouds.org/documentation/classpcl_1_1_statistical_outlier_removal.html">StatisticalOutlierRemoval</a> filter
(see <a class="reference external" href="https://pcl.readthedocs.io/projects/tutorials/en/master/statistical_outlier.html?highlight=outlier">Removing outliers using a StatisticalOutlierRemoval filter</a>)</p>
<p>The only mandatory parameter is the cloud.</p>
<p>The result is a selection (<a class="reference internal" href="ccPointCloud.html#cloudComPy.ReferenceCloud" title="cloudComPy.ReferenceCloud"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReferenceCloud</span></code></a>)
that must be transformed in <a class="reference internal" href="ccPointCloud.html#cloudComPy.ccPointCloud" title="cloudComPy.ccPointCloud"><code class="xref py py-class docutils literal notranslate"><span class="pre">ccPointCloud</span></code></a> with <a class="reference internal" href="ccPointCloud.html#cloudComPy.ccPointCloud.partialClone" title="cloudComPy.ccPointCloud.partialClone"><code class="xref py py-meth docutils literal notranslate"><span class="pre">partialClone()</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">refCloud</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">CloudSamplingTools</span><span class="o">.</span><span class="n">sorFilter</span><span class="p">(</span><span class="n">randomCloud</span><span class="p">)</span>
<span class="p">(</span><span class="n">sorCloud</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span> <span class="o">=</span> <span class="n">randomCloud</span><span class="o">.</span><span class="n">partialClone</span><span class="p">(</span><span class="n">refCloud</span><span class="p">)</span>
<span class="n">sorCloud</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">&quot;sorCloud&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">refCloud</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">43000</span> <span class="ow">or</span> <span class="n">refCloud</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">45000</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
<span class="k">if</span> <span class="n">res</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
</pre></div>
</div>
</section>
<section id="subsample-cloud-with-octree-at-level">
<h3><span class="section-number">6.8.7. </span>subsample cloud with octree at level<a class="headerlink" href="#subsample-cloud-with-octree-at-level" title="Permalink to this heading"></a></h3>
<p>The <a class="reference internal" href="cloudSamplingTools.html#cloudComPy.CloudSamplingTools.subsampleCloudWithOctreeAtLevel" title="cloudComPy.CloudSamplingTools.subsampleCloudWithOctreeAtLevel"><code class="xref py py-meth docutils literal notranslate"><span class="pre">subsampleCloudWithOctreeAtLevel()</span></code></a> method
applies a subsampling algorithm inside each cell of the octree.
The different subsampling methods are represented as an enumerator
(see <a class="reference internal" href="cloudSamplingTools.html#cloudComPy.SUBSAMPLING_CELL_METHOD" title="cloudComPy.SUBSAMPLING_CELL_METHOD"><code class="xref py py-class docutils literal notranslate"><span class="pre">SUBSAMPLING_CELL_METHOD</span></code></a>)
and consist in simple processes such as choosing a random point,
or the one closest to the cell center.</p>
<p>The mandatory parameters are the cloud, the octree level and the subsampling method.</p>
<p>The result is a selection (<a class="reference internal" href="ccPointCloud.html#cloudComPy.ReferenceCloud" title="cloudComPy.ReferenceCloud"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReferenceCloud</span></code></a>)
that must be transformed in <a class="reference internal" href="ccPointCloud.html#cloudComPy.ccPointCloud" title="cloudComPy.ccPointCloud"><code class="xref py py-class docutils literal notranslate"><span class="pre">ccPointCloud</span></code></a> with <a class="reference internal" href="ccPointCloud.html#cloudComPy.ccPointCloud.partialClone" title="cloudComPy.ccPointCloud.partialClone"><code class="xref py py-meth docutils literal notranslate"><span class="pre">partialClone()</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">refCloud</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">CloudSamplingTools</span><span class="o">.</span><span class="n">subsampleCloudWithOctreeAtLevel</span><span class="p">(</span><span class="n">cloud</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span>
                    <span class="n">cc</span><span class="o">.</span><span class="n">SUBSAMPLING_CELL_METHOD</span><span class="o">.</span><span class="n">NEAREST_POINT_TO_CELL_CENTER</span><span class="p">)</span>
<span class="p">(</span><span class="n">subOctLevCloud</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span> <span class="o">=</span> <span class="n">cloud</span><span class="o">.</span><span class="n">partialClone</span><span class="p">(</span><span class="n">refCloud</span><span class="p">)</span>
<span class="n">subOctLevCloud</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">&quot;subOctLevCloud&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">refCloud</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">2262</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
<span class="k">if</span> <span class="n">res</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
</pre></div>
</div>
</section>
<section id="subsample-cloud-with-octree">
<h3><span class="section-number">6.8.8. </span>subsample cloud with octree<a class="headerlink" href="#subsample-cloud-with-octree" title="Permalink to this heading"></a></h3>
<p>The <a class="reference internal" href="cloudSamplingTools.html#cloudComPy.CloudSamplingTools.subsampleCloudWithOctree" title="cloudComPy.CloudSamplingTools.subsampleCloudWithOctree"><code class="xref py py-meth docutils literal notranslate"><span class="pre">subsampleCloudWithOctree()</span></code></a> method
is the same as <a class="reference internal" href="cloudSamplingTools.html#cloudComPy.CloudSamplingTools.subsampleCloudWithOctreeAtLevel" title="cloudComPy.CloudSamplingTools.subsampleCloudWithOctreeAtLevel"><code class="xref py py-meth docutils literal notranslate"><span class="pre">subsampleCloudWithOctreeAtLevel()</span></code></a> method,
apart the fact that instead of giving a specific octree subdivision level as input parameter,
one can specify an approximative number of points for the resulting cloud
(the algorithm will automatically determine the corresponding octree level).</p>
<p>The mandatory parameters are the cloud, the approximate number of points and the subsampling method.</p>
<p>The result is a selection (<a class="reference internal" href="ccPointCloud.html#cloudComPy.ReferenceCloud" title="cloudComPy.ReferenceCloud"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReferenceCloud</span></code></a>)
that must be transformed in <a class="reference internal" href="ccPointCloud.html#cloudComPy.ccPointCloud" title="cloudComPy.ccPointCloud"><code class="xref py py-class docutils literal notranslate"><span class="pre">ccPointCloud</span></code></a> with <a class="reference internal" href="ccPointCloud.html#cloudComPy.ccPointCloud.partialClone" title="cloudComPy.ccPointCloud.partialClone"><code class="xref py py-meth docutils literal notranslate"><span class="pre">partialClone()</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">refCloud</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">CloudSamplingTools</span><span class="o">.</span><span class="n">subsampleCloudWithOctree</span><span class="p">(</span><span class="n">cloud</span><span class="p">,</span> <span class="mi">25000</span><span class="p">,</span>
                                 <span class="n">cc</span><span class="o">.</span><span class="n">SUBSAMPLING_CELL_METHOD</span><span class="o">.</span><span class="n">RANDOM_POINT</span><span class="p">)</span>
<span class="p">(</span><span class="n">subOctreeCloud</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span> <span class="o">=</span> <span class="n">cloud</span><span class="o">.</span><span class="n">partialClone</span><span class="p">(</span><span class="n">refCloud</span><span class="p">)</span>
<span class="n">subOctreeCloud</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">&quot;subOctreeCloud&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">refCloud</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">36777</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
<span class="k">if</span> <span class="n">res</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
</pre></div>
</div>
<p>All the above code snippets are from <a class="reference download internal" download="" href="_downloads/5d327f063b4613d64a4a287b15f97c01/test019.py"><code class="xref download docutils literal notranslate"><span class="pre">test019.py</span></code></a>.</p>
</section>
<section id="filter-by-scalar-field-values">
<h3><span class="section-number">6.8.9. </span>filter by scalar field values<a class="headerlink" href="#filter-by-scalar-field-values" title="Permalink to this heading"></a></h3>
<p>The <a class="reference internal" href="cloudComPy.html#cloudComPy.filterBySFValue" title="cloudComPy.filterBySFValue"><code class="xref py py-func docutils literal notranslate"><span class="pre">cloudComPy.filterBySFValue()</span></code></a> method
creates a new point cloud by filtering points using the current out ScalarField
(see <a class="reference internal" href="ccPointCloud.html#cloudComPy.ccPointCloud.setCurrentOutScalarField" title="cloudComPy.ccPointCloud.setCurrentOutScalarField"><code class="xref py py-meth docutils literal notranslate"><span class="pre">cloudComPy.ccPointCloud.setCurrentOutScalarField()</span></code></a>).
It keeps the points whose ScalarField value is between the min and max parameters.</p>
<p>Here, we create a scalar field based on curvature:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">radius</span> <span class="o">=</span> <span class="mf">0.03</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">computeCurvature</span><span class="p">(</span><span class="n">cc</span><span class="o">.</span><span class="n">CurvatureType</span><span class="o">.</span><span class="n">GAUSSIAN_CURV</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="p">[</span><span class="n">cloud</span><span class="p">])</span>
<span class="n">nsf</span> <span class="o">=</span> <span class="n">cloud</span><span class="o">.</span><span class="n">getNumberOfScalarFields</span><span class="p">()</span>
<span class="n">sfc</span> <span class="o">=</span> <span class="n">cloud</span><span class="o">.</span><span class="n">getScalarField</span><span class="p">(</span><span class="n">nsf</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="k">if</span> <span class="n">sfc</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;Gaussian curvature (0.03)&quot;</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
</pre></div>
</div>
<p>Then, we apply the filter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">cloud</span><span class="o">.</span><span class="n">setCurrentOutScalarField</span><span class="p">(</span><span class="n">nsf</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">fcloud</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">filterBySFValue</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">sfc</span><span class="o">.</span><span class="n">getMax</span><span class="p">(),</span> <span class="n">cloud</span><span class="p">)</span>
<span class="n">filteredSize</span> <span class="o">=</span> <span class="n">fcloud</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</pre></div>
</div>
<p>The above code snippets are from <a class="reference download internal" download="" href="_downloads/ea4008d98276703c031b28bf9ed31dfe/test003.py"><code class="xref download docutils literal notranslate"><span class="pre">test003.py</span></code></a>.</p>
</section>
</section>
<section id="generate-histograms">
<h2><span class="section-number">6.9. </span>Generate histograms<a class="headerlink" href="#generate-histograms" title="Permalink to this heading"></a></h2>
<p>To draw plots or to generate csv files from scalar field data, we use numpy, matplotlib and csv.</p>
<section id="histogram-as-a-figure">
<h3><span class="section-number">6.9.1. </span>histogram as a figure<a class="headerlink" href="#histogram-as-a-figure" title="Permalink to this heading"></a></h3>
<p>Here, we want to obtain a histogram of distances as a figure from a scalar field.
We get a numpy array from the scalar field.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">sf</span> <span class="o">=</span> <span class="n">cloud</span><span class="o">.</span><span class="n">getScalarField</span><span class="p">(</span><span class="n">cloud</span><span class="o">.</span><span class="n">getScalarFieldDic</span><span class="p">()[</span><span class="s1">&#39;C2M absolute distances&#39;</span><span class="p">])</span>
<span class="n">asf</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">toNpArray</span><span class="p">()</span>
</pre></div>
</div>
<p>We need matplotlib and numpy.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">colors</span>
</pre></div>
</div>
<p>Building a png histogram from a Numpy array is a standard use of matplotlib.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;agg&#39;</span><span class="p">)</span> <span class="c1"># png images</span>

<span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">asf</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># histogram for matplotlib</span>
<span class="n">fracs</span> <span class="o">=</span> <span class="n">bins</span> <span class="o">/</span> <span class="n">bins</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">fracs</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">fracs</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="k">for</span> <span class="n">thisfrac</span><span class="p">,</span> <span class="n">thispatch</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">fracs</span><span class="p">,</span> <span class="n">patches</span><span class="p">):</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">thisfrac</span><span class="p">))</span>
    <span class="n">thispatch</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dataDir</span><span class="p">,</span> <span class="s2">&quot;histogram.png&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>The above code snippets are from <a class="reference download internal" download="" href="_downloads/9abf5d838b759f79094371b7cf3a9291/test022.py"><code class="xref download docutils literal notranslate"><span class="pre">test022.py</span></code></a>.</p>
</section>
<section id="histogram-as-a-csv-file">
<h3><span class="section-number">6.9.2. </span>histogram as a csv file<a class="headerlink" href="#histogram-as-a-csv-file" title="Permalink to this heading"></a></h3>
<p>Here, we want to obtain a histogram of distances as a csv file from a scalar field.
We get a numpy array from the scalar field.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">sf</span> <span class="o">=</span> <span class="n">cloud</span><span class="o">.</span><span class="n">getScalarField</span><span class="p">(</span><span class="n">cloud</span><span class="o">.</span><span class="n">getScalarFieldDic</span><span class="p">()[</span><span class="s1">&#39;C2M absolute distances&#39;</span><span class="p">])</span>
<span class="n">asf</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">toNpArray</span><span class="p">()</span>
</pre></div>
</div>
<p>We need matplotlib and csv.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">csv</span>
</pre></div>
</div>
<p>Building a csv histogram from a Numpy array is a standard use of csv.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">asf</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span> <span class="c1"># numpy histogram (without graphics)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dataDir</span><span class="p">,</span> <span class="s2">&quot;histogram.csv&quot;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">((</span><span class="s2">&quot;Class&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="s2">&quot;Class start&quot;</span><span class="p">,</span> <span class="s2">&quot;Class end&quot;</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">bins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">bins</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
<p>The above code snippets are from <a class="reference download internal" download="" href="_downloads/9abf5d838b759f79094371b7cf3a9291/test022.py"><code class="xref download docutils literal notranslate"><span class="pre">test022.py</span></code></a>.</p>
</section>
</section>
<section id="compute-a-2-5d-volume">
<h2><span class="section-number">6.10. </span>Compute a 2.5D volume<a class="headerlink" href="#compute-a-2-5d-volume" title="Permalink to this heading"></a></h2>
<p>This corresponds to the CloudCompare GUI <a class="reference external" href="https://www.cloudcompare.org/doc/wiki/index.php/2.5D_Volume">2.5D Volume</a></p>
<p>The <a class="reference internal" href="cloudComPy.html#cloudComPy.ComputeVolume25D" title="cloudComPy.ComputeVolume25D"><code class="xref py py-func docutils literal notranslate"><span class="pre">cloudComPy.ComputeVolume25D()</span></code></a> method
computes a 2.5D volume between a cloud and a ground plane,or two clouds,
following a given direction (X, Y or Z).
If only one cloud is given, the direction (X, Y or Z) defines the normal to the plane used for calculation.
The calculation uses a cartesian grid, you provide the gridStep.</p>
<p>The <a class="reference internal" href="cloudComPy.html#cloudComPy.ReportInfoVol" title="cloudComPy.ReportInfoVol"><code class="xref py py-class docutils literal notranslate"><span class="pre">cloudComPy.ReportInfoVol</span></code></a> structure is completed by the calculation and the following information:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 31%" />
<col style="width: 69%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>volume:</p></td>
<td><p>the resulting volume</p></td>
</tr>
<tr class="row-even"><td><p>addedVolume:</p></td>
<td><p>the positive part of the volume (ceil &gt; floor)</p></td>
</tr>
<tr class="row-odd"><td><p>removedVolume:</p></td>
<td><p>the negative part of the volume (ceil &lt; floor)</p></td>
</tr>
<tr class="row-even"><td><p>surface:</p></td>
<td><p>the section of the point cloud along in the given direction</p></td>
</tr>
<tr class="row-odd"><td><p>matchingPercent:</p></td>
<td><p>percentage of the section matching ceil and floor</p></td>
</tr>
<tr class="row-even"><td><p>ceilNonMatchingPercent:</p></td>
<td><p>percentage of the ceil section non matching floor</p></td>
</tr>
<tr class="row-odd"><td><p>float groundNonMatchingPercent:</p></td>
<td><p>percentage of the floor section non matching ceil</p></td>
</tr>
<tr class="row-even"><td><p>int averageNeighborsPerCell:</p></td>
<td><p>average Neighbor number per cell</p>
<p>(see <code class="docutils literal notranslate"><span class="pre">gridStep</span></code> argument of <a class="reference internal" href="cloudComPy.html#cloudComPy.ComputeVolume25D" title="cloudComPy.ComputeVolume25D"><code class="xref py py-func docutils literal notranslate"><span class="pre">ComputeVolume25D()</span></code></a>)</p>
</td>
</tr>
</tbody>
</table>
<p>A first example with a flat floor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">cloud</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">loadPointCloud</span><span class="p">(</span><span class="n">getSampleCloud</span><span class="p">(</span><span class="mf">5.0</span><span class="p">))</span>

<span class="n">report</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ReportInfoVol</span><span class="p">()</span>
<span class="n">isOk</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ComputeVolume25D</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">ground</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ceil</span><span class="o">=</span><span class="n">cloud</span><span class="p">,</span> 
                           <span class="n">vertDim</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">gridStep</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">groundHeight</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ceilHeight</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>check the results:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">isOk</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">report</span><span class="o">.</span><span class="n">volume</span><span class="p">,</span> <span class="mf">0.995</span><span class="p">,</span> <span class="n">rel_tol</span><span class="o">=</span><span class="mf">1e-03</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">report</span><span class="o">.</span><span class="n">surface</span><span class="p">,</span> <span class="mf">101.002</span><span class="p">,</span> <span class="n">rel_tol</span><span class="o">=</span><span class="mf">1e-03</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">report</span><span class="o">.</span><span class="n">addedVolume</span><span class="p">,</span> <span class="mf">11.726</span><span class="p">,</span> <span class="n">rel_tol</span><span class="o">=</span><span class="mf">1e-03</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">report</span><span class="o">.</span><span class="n">removedVolume</span><span class="p">,</span> <span class="mf">10.731</span><span class="p">,</span> <span class="n">rel_tol</span><span class="o">=</span><span class="mf">1e-03</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">report</span><span class="o">.</span><span class="n">matchingPercent</span><span class="p">,</span> <span class="mf">100.</span><span class="p">,</span> <span class="n">rel_tol</span><span class="o">=</span><span class="mf">1e-03</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">report</span><span class="o">.</span><span class="n">ceilNonMatchingPercent</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">1e-03</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">report</span><span class="o">.</span><span class="n">groundNonMatchingPercent</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">1e-03</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">report</span><span class="o">.</span><span class="n">averageNeighborsPerCell</span><span class="p">,</span> <span class="mf">8.</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">1e-03</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
</pre></div>
</div>
<p>A second example with a cloud floor, translated to obtain non matching parts:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">cloud2</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">loadPointCloud</span><span class="p">(</span><span class="n">getSampleCloud</span><span class="p">(</span><span class="mf">2.0</span><span class="p">))</span>
<span class="n">cloud2</span><span class="o">.</span><span class="n">translate</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">))</span> <span class="c1"># creates a translated floor, </span>
                            <span class="c1"># with a non matching part with the ceil </span>

<span class="n">report</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ReportInfoVol</span><span class="p">()</span>
<span class="n">isOk</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ComputeVolume25D</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">ground</span><span class="o">=</span><span class="n">cloud2</span><span class="p">,</span> <span class="n">ceil</span><span class="o">=</span><span class="n">cloud</span><span class="p">,</span>
                           <span class="n">vertDim</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">gridStep</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">groundHeight</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ceilHeight</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
</pre></div>
</div>
<p>check the results:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">isOk</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">report</span><span class="o">.</span><span class="n">volume</span><span class="p">,</span> <span class="mf">216.609</span><span class="p">,</span> <span class="n">rel_tol</span><span class="o">=</span><span class="mf">1e-03</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">report</span><span class="o">.</span><span class="n">surface</span><span class="p">,</span> <span class="mf">72.852</span><span class="p">,</span> <span class="n">rel_tol</span><span class="o">=</span><span class="mf">1e-03</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">report</span><span class="o">.</span><span class="n">addedVolume</span><span class="p">,</span> <span class="mf">216.609</span><span class="p">,</span> <span class="n">rel_tol</span><span class="o">=</span><span class="mf">1e-03</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">report</span><span class="o">.</span><span class="n">removedVolume</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">rel_tol</span><span class="o">=</span><span class="mf">1e-03</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">report</span><span class="o">.</span><span class="n">matchingPercent</span><span class="p">,</span> <span class="mf">56.4</span><span class="p">,</span> <span class="n">rel_tol</span><span class="o">=</span><span class="mf">1e-03</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">report</span><span class="o">.</span><span class="n">ceilNonMatchingPercent</span><span class="p">,</span> <span class="mf">21.8</span><span class="p">,</span> <span class="n">rel_tol</span><span class="o">=</span><span class="mf">1e-03</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">report</span><span class="o">.</span><span class="n">groundNonMatchingPercent</span><span class="p">,</span> <span class="mf">21.8</span><span class="p">,</span> <span class="n">rel_tol</span><span class="o">=</span><span class="mf">1e-03</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">report</span><span class="o">.</span><span class="n">averageNeighborsPerCell</span><span class="p">,</span> <span class="mf">7.93</span><span class="p">,</span> <span class="n">rel_tol</span><span class="o">=</span><span class="mf">1e-03</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
</pre></div>
</div>
<p>The above code snippets are from <a class="reference download internal" download="" href="_downloads/066e54291bc416a4bb5a23362395f38f/test023.py"><code class="xref download docutils literal notranslate"><span class="pre">test023.py</span></code></a>.</p>
</section>
<section id="cloud-rasterization">
<h2><span class="section-number">6.11. </span>Cloud rasterization<a class="headerlink" href="#cloud-rasterization" title="Permalink to this heading"></a></h2>
<p>The main purpose of this tool is to ‘rasterize’ a point cloud (i.e. convert it to a 2.5D grid)
and then export it as a new cloud or a raster image (GeoTiff) for instance.
Concepts are introduced in the CloudCompare wiki <a class="reference external" href="https://www.cloudcompare.org/doc/wiki/index.php/Rasterize">Rasterize</a></p>
<p>Three functions are available for rasterization.</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="cloudComPy.html#cloudComPy.RasterizeGeoTiffOnly" title="cloudComPy.RasterizeGeoTiffOnly"><code class="xref py py-func docutils literal notranslate"><span class="pre">cloudComPy.RasterizeGeoTiffOnly()</span></code></a></p></li>
<li><p><a class="reference internal" href="cloudComPy.html#cloudComPy.RasterizeToCloud" title="cloudComPy.RasterizeToCloud"><code class="xref py py-func docutils literal notranslate"><span class="pre">cloudComPy.RasterizeToCloud()</span></code></a></p></li>
<li><p><a class="reference internal" href="cloudComPy.html#cloudComPy.RasterizeToMesh" title="cloudComPy.RasterizeToMesh"><code class="xref py py-func docutils literal notranslate"><span class="pre">cloudComPy.RasterizeToMesh()</span></code></a></p></li>
</ul>
</div></blockquote>
<p>All functions have a lot of parameters,
to produce or not GeoTiff files, with or without scalar fields or colors,
to fill or not the empty cells, to export statistic scalar fields…</p>
<p>The <code class="docutils literal notranslate"><span class="pre">gridStep</span></code> parameter is mandatory in all rasterize methods.</p>
<p>The code snippets below are from  <a class="reference download internal" download="" href="_downloads/534f775bc454aa821a69886d0ba8072d/test025.py"><code class="xref download docutils literal notranslate"><span class="pre">test025.py</span></code></a>.
See the clouds and meshes generated by this test to understand the different options.</p>
<p>We start from a wave cloud created with a random generator,
to obtain points with random (x,y) coordinates (not on a grid).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="c1"># --- generate a set of coords and a scalar field</span>

<span class="n">npts</span> <span class="o">=</span> <span class="mi">1000000</span>
<span class="n">h</span> <span class="o">=</span> <span class="mf">2.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="o">-</span><span class="mf">5.</span> <span class="o">+</span> <span class="mf">10.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="n">npts</span><span class="p">)))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="o">-</span><span class="mf">5.</span> <span class="o">+</span> <span class="mf">10.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="n">npts</span><span class="p">)))</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">h</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">))</span>

<span class="c1"># --- create the pointCloud</span>

<span class="n">cloud</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccPointCloud</span><span class="p">(</span><span class="s2">&quot;wave_</span><span class="si">%d</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">h</span><span class="p">)</span>
<span class="n">cloud</span><span class="o">.</span><span class="n">coordsFromNPArray_copy</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>

<span class="c1"># --- add the scalar field</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">cloud</span><span class="o">.</span><span class="n">exportCoordToSF</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>For a simple rasterisation to cloud:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">rcloud</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">RasterizeToCloud</span><span class="p">(</span><span class="n">cloud</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
</pre></div>
</div>
<p>With the default options, empty cells stays empty.</p>
<p>Below, an example where the empty cells are filled with a forced constant height,
and with a GeoTiff file With raster altitude.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">rcloud1</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">RasterizeToCloud</span><span class="p">(</span><span class="n">cloud</span><span class="p">,</span>
                          <span class="n">gridStep</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> 
                          <span class="n">outputRasterZ</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                          <span class="n">pathToImages</span> <span class="o">=</span> <span class="n">dataDir</span><span class="p">,</span>
                          <span class="n">emptyCellFillStrategy</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">EmptyCellFillOption</span><span class="o">.</span><span class="n">FILL_CUSTOM_HEIGHT</span><span class="p">,</span>
                          <span class="n">customHeight</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span>
                          <span class="n">export_perCellCount</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Below, an example where the empty cells are filled with an iterpolated height,
and with a GeoTiff file With raster altitude and scalar fields.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">rcloud2</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">RasterizeToCloud</span><span class="p">(</span><span class="n">cloud</span><span class="p">,</span>
                          <span class="n">gridStep</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> 
                          <span class="n">outputRasterZ</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                          <span class="n">outputRasterSFs</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                          <span class="n">pathToImages</span> <span class="o">=</span> <span class="n">dataDir</span><span class="p">,</span>
                          <span class="n">emptyCellFillStrategy</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">EmptyCellFillOption</span><span class="o">.</span><span class="n">INTERPOLATE</span><span class="p">,</span>
                          <span class="n">export_perCellCount</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                          <span class="n">export_perCellAvgHeight</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, we generate only the GeoTiff file With raster altitude and scalar fields.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">cloud</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">&quot;wave_g2&quot;</span><span class="p">)</span> <span class="c1"># to distinguish the GeoTiff file from the previous one</span>
<span class="n">cc</span><span class="o">.</span><span class="n">RasterizeGeoTiffOnly</span><span class="p">(</span><span class="n">cloud</span><span class="p">,</span>
                        <span class="n">gridStep</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> 
                        <span class="n">outputRasterZ</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                        <span class="n">outputRasterSFs</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                        <span class="n">pathToImages</span> <span class="o">=</span> <span class="n">dataDir</span><span class="p">,</span>
                        <span class="n">emptyCellFillStrategy</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">EmptyCellFillOption</span><span class="o">.</span><span class="n">FILL_MAXIMUM_HEIGHT</span><span class="p">,</span>
                        <span class="n">customHeight</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span>
                        <span class="n">export_perCellCount</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, a simple rasterization to mesh:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">rmesh</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">RasterizeToMesh</span><span class="p">(</span><span class="n">cloud</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="interpolate-scalar-fields-from-one-cloud-to-another">
<h2><span class="section-number">6.12. </span>Interpolate scalar fields from one cloud to another<a class="headerlink" href="#interpolate-scalar-fields-from-one-cloud-to-another" title="Permalink to this heading"></a></h2>
<p>The concepts are introduced in the CloudCompare wiki
<a class="reference external" href="https://www.cloudcompare.org/doc/wiki/index.php/Scalar_fields%5CInterpolate_from_another_entity">interpolate scalar fields</a></p>
<p>In the following example, 3 scalar fields from a cloud are selected for interpolation on another cloud.
the <a class="reference internal" href="cloudComPy.html#cloudComPy.interpolatorParameters" title="cloudComPy.interpolatorParameters"><code class="xref py py-class docutils literal notranslate"><span class="pre">interpolatorParameters</span></code></a> class is used to define the method, algorithm and values required for the interpolation.
The <a class="reference internal" href="cloudComPy.html#cloudComPy.interpolateScalarFieldsFrom" title="cloudComPy.interpolateScalarFieldsFrom"><code class="xref py py-func docutils literal notranslate"><span class="pre">cloudComPy.interpolateScalarFieldsFrom()</span></code></a> function computes the interpolation.</p>
<p>Here, the distance between the clouds is locally greater than the radius, so the interpolated scalar fields are filed with NaN in some places.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">cloud1</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">loadPointCloud</span><span class="p">(</span><span class="n">getSampleCloud</span><span class="p">(</span><span class="mf">5.0</span><span class="p">))</span>
<span class="n">cloud2</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">loadPointCloud</span><span class="p">(</span><span class="n">getSampleCloud</span><span class="p">(</span><span class="mf">1.0</span><span class="p">))</span>
<span class="n">cloud1</span><span class="o">.</span><span class="n">exportCoordToSF</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">dic</span> <span class="o">=</span> <span class="n">cloud1</span><span class="o">.</span><span class="n">getScalarFieldDic</span><span class="p">()</span>

<span class="n">params</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">interpolatorParameters</span><span class="p">()</span>
<span class="n">params</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">INTERPOL_METHOD</span><span class="o">.</span><span class="n">RADIUS</span>
<span class="n">params</span><span class="o">.</span><span class="n">algos</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">INTERPOL_ALGO</span><span class="o">.</span><span class="n">NORMAL_DIST</span>
<span class="n">params</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="mf">0.15</span>
<span class="n">params</span><span class="o">.</span><span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.06</span>

<span class="n">sfIndexes</span> <span class="o">=</span> <span class="p">[</span><span class="n">dic</span><span class="p">[</span><span class="s1">&#39;Coord. X&#39;</span><span class="p">],</span> <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;Coord. Y&#39;</span><span class="p">],</span> <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;Coord. Z&#39;</span><span class="p">]]</span>

<span class="n">ret</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">interpolateScalarFieldsFrom</span><span class="p">(</span><span class="n">cloud2</span><span class="p">,</span> <span class="n">cloud1</span><span class="p">,</span> <span class="n">sfIndexes</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
<p>The above code snippet is from <a class="reference download internal" download="" href="_downloads/539b7040e4e2bb8026bc262c712d8a5c/test044.py"><code class="xref download docutils literal notranslate"><span class="pre">test044.py</span></code></a>.</p>
</section>
<section id="finding-an-optimal-bounding-box">
<h2><span class="section-number">6.13. </span>Finding an optimal bounding box<a class="headerlink" href="#finding-an-optimal-bounding-box" title="Permalink to this heading"></a></h2>
<p><code class="xref py py-mod docutils literal notranslate"><span class="pre">minimalBoundingBox</span></code> is a pure Python plugin built with CloudComPy.</p>
<p>This tool is provided as an example of CloudComPy pure Python extension.</p>
<p>The <a class="reference internal" href="MinimalBoundingBox.html#cloudComPy.minimalBoundingBox.findRotation" title="cloudComPy.minimalBoundingBox.findRotation"><code class="xref py py-func docutils literal notranslate"><span class="pre">findRotation()</span></code></a> function finds a minimal bounding box for a cloud,
not oriented along the main axes, and the corresponding rotation.
It is not proven that the solution meets to the minimum, and the performance and robustness
can certainly be improved.</p>
<p>We have to import minimalBoundingBox</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="kn">from</span> <span class="nn">cloudComPy.minimalBoundingBox</span> <span class="kn">import</span> <span class="n">findRotation</span>
</pre></div>
</div>
<p>We create an ellipsoid, and apply a rotation on it, so that its bounding box is far from optimal.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">sphere</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccSphere</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">cloud</span> <span class="o">=</span> <span class="n">sphere</span><span class="o">.</span><span class="n">samplePoints</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="mi">100000</span><span class="p">)</span>
<span class="n">cloud</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">)</span>

<span class="n">cloudBeforeRot</span> <span class="o">=</span> <span class="n">cloud</span><span class="o">.</span><span class="n">cloneThis</span><span class="p">()</span>
<span class="n">cloudBeforeRot</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">&quot;cloudBeforeRot&quot;</span><span class="p">)</span>

<span class="n">transform1</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccGLMatrix</span><span class="p">()</span>
<span class="n">transform1</span><span class="o">.</span><span class="n">initFromParameters</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="n">cloud</span><span class="o">.</span><span class="n">applyRigidTransformation</span><span class="p">(</span><span class="n">transform1</span><span class="p">)</span>
<span class="n">cloud</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">&quot;rotated object&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="MinimalBoundingBox.html#cloudComPy.minimalBoundingBox.findRotation" title="cloudComPy.minimalBoundingBox.findRotation"><code class="xref py py-func docutils literal notranslate"><span class="pre">findRotation()</span></code></a> function returns several objects.</p>
<blockquote>
<div><ul class="simple">
<li><p>the optimized bounding box</p></li>
<li><p>the rotation (double precision) to go the object on axes to the original object</p></li>
<li><p>the polyline representing the optimal bounding box, aligned with the original object</p></li>
<li><p>the cloud associated to this polyline</p></li>
</ul>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">boundingBox</span><span class="p">,</span> <span class="n">rotinv</span><span class="p">,</span> <span class="n">poly</span><span class="p">,</span> <span class="n">clbbox</span> <span class="o">=</span> <span class="n">findRotation</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
</pre></div>
</div>
<p>To check the results, we apply the rotation (inverse) to a copy of the cloud and polyline.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">rotation</span> <span class="o">=</span> <span class="p">(</span><span class="n">cc</span><span class="o">.</span><span class="n">ccGLMatrix</span><span class="o">.</span><span class="n">fromDouble</span><span class="p">(</span><span class="n">rotinv</span><span class="p">))</span><span class="o">.</span><span class="n">inverse</span><span class="p">()</span>
<span class="n">axisObj</span> <span class="o">=</span> <span class="n">cloud</span><span class="o">.</span><span class="n">cloneThis</span><span class="p">()</span>
<span class="n">axisObj</span><span class="o">.</span><span class="n">applyRigidTransformation</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span>
<span class="n">axisObj</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">&quot;object on axes&quot;</span><span class="p">)</span>

<span class="n">clb</span> <span class="o">=</span> <span class="n">clbbox</span><span class="o">.</span><span class="n">cloneThis</span><span class="p">()</span>
<span class="n">clb</span><span class="o">.</span><span class="n">applyRigidTransformation</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span>
<span class="n">axisPoly</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccPolyline</span><span class="p">(</span><span class="n">clb</span><span class="p">)</span>
<span class="n">axisPoly</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span><span class="n">clb</span><span class="p">)</span>
<span class="n">axisPoly</span><span class="o">.</span><span class="n">addPointIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">clb</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
<span class="n">axisPoly</span><span class="o">.</span><span class="n">setClosed</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">SaveEntities</span><span class="p">([</span><span class="n">cloudBeforeRot</span><span class="p">,</span> <span class="n">cloud</span><span class="p">,</span> <span class="n">axisObj</span><span class="p">,</span> <span class="n">poly</span><span class="p">,</span> <span class="n">axisPoly</span><span class="p">],</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dataDir</span><span class="p">,</span> <span class="s2">&quot;optimalBoundingBox.bin&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>The above code snippets are from <a class="reference download internal" download="" href="_downloads/b5e7732b47864ba9b36e302620434574/test027.py"><code class="xref download docutils literal notranslate"><span class="pre">test027.py</span></code></a>.</p>
</section>
<section id="cloud-comparison-with-plugin-m3c2">
<span id="cloud-comparison-m3c2"></span><h2><span class="section-number">6.14. </span>Cloud comparison with plugin M3C2<a class="headerlink" href="#cloud-comparison-with-plugin-m3c2" title="Permalink to this heading"></a></h2>
<p>The <a class="reference internal" href="M3C2.html#module-cloudComPy.M3C2" title="cloudComPy.M3C2"><code class="xref py py-mod docutils literal notranslate"><span class="pre">M3C2</span></code></a> plugin is introduced
in the <a class="reference external" href="http://www.cloudcompare.org/doc/wiki/index.php/M3C2_(plugin)">CloudCompare Plugins wiki - M3C2</a>.
The plugin computes signed distances between two clouds.</p>
<p>The <a class="reference internal" href="M3C2.html#cloudComPy.M3C2.computeM3C2" title="cloudComPy.M3C2.computeM3C2"><code class="xref py py-func docutils literal notranslate"><span class="pre">computeM3C2()</span></code></a> function relies on a large number of parameters grouped in a file.
The CloudCompare GUI offers a ‘guess parameters’ option and a way to save the parameters to a file.
The <a class="reference internal" href="M3C2.html#cloudComPy.M3C2.M3C2guessParamsToFile" title="cloudComPy.M3C2.M3C2guessParamsToFile"><code class="xref py py-func docutils literal notranslate"><span class="pre">M3C2guessParamsToFile()</span></code></a> function do the same job.</p>
<p>You have to import the The <a class="reference internal" href="M3C2.html#module-cloudComPy.M3C2" title="cloudComPy.M3C2"><code class="xref py py-mod docutils literal notranslate"><span class="pre">M3C2</span></code></a> plugin.
The <a class="reference internal" href="M3C2.html#cloudComPy.M3C2.M3C2guessParamsToFile" title="cloudComPy.M3C2.M3C2guessParamsToFile"><code class="xref py py-func docutils literal notranslate"><span class="pre">M3C2guessParamsToFile()</span></code></a> function requires the two clouds, the params file,
and a boolean to get a fast guess or not.
The <a class="reference internal" href="M3C2.html#cloudComPy.M3C2.computeM3C2" title="cloudComPy.M3C2.computeM3C2"><code class="xref py py-func docutils literal notranslate"><span class="pre">computeM3C2()</span></code></a> function requires only the two clouds and the params file,
and produces a cloud with new scalar field ‘M3C2 distance’:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="k">if</span> <span class="n">cc</span><span class="o">.</span><span class="n">isPluginM3C2</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">cloudComPy.M3C2</span>
    <span class="n">cloud</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">loadPointCloud</span><span class="p">(</span><span class="n">getSampleCloud</span><span class="p">(</span><span class="mf">5.0</span><span class="p">))</span>
    <span class="n">cloud1</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">loadPointCloud</span><span class="p">(</span><span class="n">getSampleCloud</span><span class="p">(</span><span class="mf">1.0</span><span class="p">))</span>
    <span class="n">paramFilename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dataDir</span><span class="p">,</span> <span class="s2">&quot;m3c2_params.txt&quot;</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">M3C2</span><span class="o">.</span><span class="n">M3C2guessParamsToFile</span><span class="p">([</span><span class="n">cloud</span><span class="p">,</span><span class="n">cloud1</span><span class="p">],</span> <span class="n">paramFilename</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">cloud2</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">M3C2</span><span class="o">.</span><span class="n">computeM3C2</span><span class="p">([</span><span class="n">cloud</span><span class="p">,</span><span class="n">cloud1</span><span class="p">],</span> <span class="n">paramFilename</span><span class="p">)</span>
</pre></div>
</div>
<p>The params file has a simple syntax and can be created from scratch or edited.
The M3C2 params file generated below corresponds to the ‘guess params’ option of the GUI for the clouds of this example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="kn">import</span> <span class="nn">multiprocessing</span>

<span class="n">m3c2_params_dic</span><span class="o">=</span><span class="p">{}</span>
<span class="n">m3c2_params_dic</span><span class="p">[</span><span class="s2">&quot;ExportDensityAtProjScale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
<span class="n">m3c2_params_dic</span><span class="p">[</span><span class="s2">&quot;ExportStdDevInfo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
<span class="n">m3c2_params_dic</span><span class="p">[</span><span class="s2">&quot;M3C2VER&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">m3c2_params_dic</span><span class="p">[</span><span class="s2">&quot;MaxThreadCount&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
<span class="n">m3c2_params_dic</span><span class="p">[</span><span class="s2">&quot;MinPoints4Stat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">m3c2_params_dic</span><span class="p">[</span><span class="s2">&quot;NormalMaxScale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.283607</span>
<span class="n">m3c2_params_dic</span><span class="p">[</span><span class="s2">&quot;NormalMinScale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.070902</span>
<span class="n">m3c2_params_dic</span><span class="p">[</span><span class="s2">&quot;NormalMode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">m3c2_params_dic</span><span class="p">[</span><span class="s2">&quot;NormalPreferedOri&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">m3c2_params_dic</span><span class="p">[</span><span class="s2">&quot;NormalScale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.141803</span>
<span class="n">m3c2_params_dic</span><span class="p">[</span><span class="s2">&quot;NormalStep&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.070902</span>
<span class="n">m3c2_params_dic</span><span class="p">[</span><span class="s2">&quot;NormalUseCorePoints&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
<span class="n">m3c2_params_dic</span><span class="p">[</span><span class="s2">&quot;PM1Scale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">m3c2_params_dic</span><span class="p">[</span><span class="s2">&quot;PM2Scale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">m3c2_params_dic</span><span class="p">[</span><span class="s2">&quot;PositiveSearchOnly&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
<span class="n">m3c2_params_dic</span><span class="p">[</span><span class="s2">&quot;ProjDestIndex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">m3c2_params_dic</span><span class="p">[</span><span class="s2">&quot;RegistrationError&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">m3c2_params_dic</span><span class="p">[</span><span class="s2">&quot;RegistrationErrorEnabled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
<span class="n">m3c2_params_dic</span><span class="p">[</span><span class="s2">&quot;SearchDepth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.709017</span>
<span class="n">m3c2_params_dic</span><span class="p">[</span><span class="s2">&quot;SearchScale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.141803</span>
<span class="n">m3c2_params_dic</span><span class="p">[</span><span class="s2">&quot;SubsampleEnabled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
<span class="n">m3c2_params_dic</span><span class="p">[</span><span class="s2">&quot;SubsampleRadius&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.070902</span>
<span class="n">m3c2_params_dic</span><span class="p">[</span><span class="s2">&quot;UseMedian&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
<span class="n">m3c2_params_dic</span><span class="p">[</span><span class="s2">&quot;UseMinPoints4Stat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
<span class="n">m3c2_params_dic</span><span class="p">[</span><span class="s2">&quot;UseOriginalCloud&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
<span class="n">m3c2_params_dic</span><span class="p">[</span><span class="s2">&quot;UsePrecisionMaps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
<span class="n">m3c2_params_dic</span><span class="p">[</span><span class="s2">&quot;UseSinglePass4Depth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>

<span class="n">paramFilename1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dataDir</span><span class="p">,</span> <span class="s2">&quot;m3c2_params1.txt&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">paramFilename1</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;[General]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">m3c2_params_dic</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">))</span>
</pre></div>
</div>
<p>To use the precision maps, you have to provide the six corresponding scalar fields in list
(3 components for the first cloud and 3 components for the second cloud),
and also two scales in a list. When these lists are provided, the computation uses the precision maps,
and supersedes the corresponding option in the params file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
    <span class="n">sfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dic</span> <span class="o">=</span> <span class="n">cloud</span><span class="o">.</span><span class="n">getScalarFieldDic</span><span class="p">()</span>
    <span class="n">sfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cloud</span><span class="o">.</span><span class="n">getScalarField</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="s2">&quot;ux&quot;</span><span class="p">]))</span>
    <span class="n">sfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cloud</span><span class="o">.</span><span class="n">getScalarField</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="s2">&quot;uy&quot;</span><span class="p">]))</span>
    <span class="n">sfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cloud</span><span class="o">.</span><span class="n">getScalarField</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="s2">&quot;uz&quot;</span><span class="p">]))</span>
    <span class="n">dic1</span> <span class="o">=</span> <span class="n">cloud1</span><span class="o">.</span><span class="n">getScalarFieldDic</span><span class="p">()</span>
    <span class="n">sfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cloud1</span><span class="o">.</span><span class="n">getScalarField</span><span class="p">(</span><span class="n">dic1</span><span class="p">[</span><span class="s2">&quot;ux&quot;</span><span class="p">]))</span>
    <span class="n">sfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cloud1</span><span class="o">.</span><span class="n">getScalarField</span><span class="p">(</span><span class="n">dic1</span><span class="p">[</span><span class="s2">&quot;uy&quot;</span><span class="p">]))</span>
    <span class="n">sfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cloud1</span><span class="o">.</span><span class="n">getScalarField</span><span class="p">(</span><span class="n">dic1</span><span class="p">[</span><span class="s2">&quot;uz&quot;</span><span class="p">]))</span>
    <span class="n">scales</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]</span>
    <span class="n">paramFilename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dataDir</span><span class="p">,</span> <span class="s2">&quot;m3c2_params2.txt&quot;</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">M3C2</span><span class="o">.</span><span class="n">M3C2guessParamsToFile</span><span class="p">([</span><span class="n">cloud</span><span class="p">,</span><span class="n">cloud1</span><span class="p">],</span> <span class="n">paramFilename</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">cloud2</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">M3C2</span><span class="o">.</span><span class="n">computeM3C2</span><span class="p">([</span><span class="n">cloud</span><span class="p">,</span><span class="n">cloud1</span><span class="p">],</span> <span class="n">paramFilename</span><span class="p">,</span> <span class="n">sfs</span><span class="p">,</span> <span class="n">scales</span><span class="p">)</span>
</pre></div>
</div>
<p>The above code snippets are from <a class="reference download internal" download="" href="_downloads/c78c49c87f85d7857d71787074c84e45/test030.py"><code class="xref download docutils literal notranslate"><span class="pre">test030.py</span></code></a>.</p>
</section>
<section id="shadevis-ambiant-occlusion-with-plugin-pcv">
<h2><span class="section-number">6.15. </span>ShadeVIS (ambiant occlusion) with Plugin PCV<a class="headerlink" href="#shadevis-ambiant-occlusion-with-plugin-pcv" title="Permalink to this heading"></a></h2>
<p>The PCV plugin is documented in the
<a class="reference external" href="http://www.cloudcompare.org/doc/wiki/index.php/ShadeVis_(plugin)">CloudCompare Plugins wiki - PCV</a>.
It calculates the illumination of a point cloud (or vertices of a mesh)
as if the light was coming from a theoretical hemisphere or sphere around the object
(the user can also provide its own set of light directions - see below).</p>
<p>You have to import the The <a class="reference internal" href="PCV.html#module-cloudComPy.PCV" title="cloudComPy.PCV"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PCV</span></code></a> plugin.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="k">if</span> <span class="n">cc</span><span class="o">.</span><span class="n">isPluginPCV</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">cloudComPy.PCV</span>
</pre></div>
</div>
<p>We first try to illuminate the cloud with a dish as light source, oriented to create unrealistic sharp shadows.
The cloud used as light source must have normals.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
    <span class="n">tr1</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccGLMatrix</span><span class="p">()</span>
    <span class="n">tr1</span><span class="o">.</span><span class="n">initFromParameters</span><span class="p">(</span><span class="mf">0.3</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
    <span class="n">dish</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccDish</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">tr1</span><span class="p">)</span>
    <span class="n">cln</span> <span class="o">=</span><span class="n">dish</span><span class="o">.</span><span class="n">getAssociatedCloud</span><span class="p">()</span>
    <span class="n">cc</span><span class="o">.</span><span class="n">computeNormals</span><span class="p">([</span><span class="n">cln</span><span class="p">])</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="PCV.html#cloudComPy.PCV.computeShadeVIS" title="cloudComPy.PCV.computeShadeVIS"><code class="xref py py-func docutils literal notranslate"><span class="pre">computeShadeVIS()</span></code></a> function takes a list of objects (clouds or meshes)
as first parameter, and will add a scalar field <cite>illuminance (PCV)</cite> to these clouds or meshes.
The second parameter is the optional light source. There are several other optional parameters.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
    <span class="n">cc</span><span class="o">.</span><span class="n">PCV</span><span class="o">.</span><span class="n">computeShadeVIS</span><span class="p">([</span><span class="n">cloud</span><span class="p">],</span><span class="n">cln</span><span class="p">)</span>
    <span class="n">dic</span> <span class="o">=</span> <span class="n">cloud</span><span class="o">.</span><span class="n">getScalarFieldDic</span><span class="p">()</span>
    <span class="n">cloud</span><span class="o">.</span><span class="n">renameScalarField</span><span class="p">(</span><span class="n">dic</span><span class="p">[</span><span class="s2">&quot;Illuminance (PCV)&quot;</span><span class="p">],</span> <span class="s2">&quot;IlluminanceDish&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The Scalar field is renamed to keep it and compute the illuminance with the default hemispheric light source.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
    <span class="n">cc</span><span class="o">.</span><span class="n">PCV</span><span class="o">.</span><span class="n">computeShadeVIS</span><span class="p">([</span><span class="n">cloud</span><span class="p">])</span>
</pre></div>
</div>
<p>The above code snippets are from <a class="reference download internal" download="" href="_downloads/a53f97e7c349a9e343d84f151bcaa7d0/test032.py"><code class="xref download docutils literal notranslate"><span class="pre">test032.py</span></code></a>.</p>
</section>
<section id="compute-hidden-point-removal-with-plugin-hpr">
<h2><span class="section-number">6.16. </span>Compute Hidden Point Removal with plugin HPR<a class="headerlink" href="#compute-hidden-point-removal-with-plugin-hpr" title="Permalink to this heading"></a></h2>
<p>The HPR plugin is described in the
<a class="reference external" href="http://www.cloudcompare.org/doc/wiki/index.php/Hidden_Point_Removal_(plugin)">CloudCompare Plugins wiki - HPR</a>.</p>
<p>The algorithm filters out the points of a cloud that wouldn’t be seen
(by the current 3D camera) if the cloud was a closed surface.
Therefore it tries to remove the points that should be hidden in the current viewport configuration.</p>
<p>Without GUI, in CloudComPy, we have to explitely provide the coordinates of the viewpoint
in <a class="reference internal" href="HPR.html#cloudComPy.HPR.computeHPR" title="cloudComPy.HPR.computeHPR"><code class="xref py py-func docutils literal notranslate"><span class="pre">computeHPR()</span></code></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="k">if</span> <span class="n">cc</span><span class="o">.</span><span class="n">isPluginHPR</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">cloudComPy.HPR</span>
    
    <span class="n">cloud</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">loadPointCloud</span><span class="p">(</span><span class="n">getSampleCloud</span><span class="p">(</span><span class="mf">5.0</span><span class="p">))</span>
    
    <span class="n">cloudCut</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">HPR</span><span class="o">.</span><span class="n">computeHPR</span><span class="p">(</span><span class="n">cloud</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="o">-</span><span class="mf">15.</span><span class="p">,</span> <span class="mf">25.</span><span class="p">))</span>
    
</pre></div>
</div>
<p>The above code snippet is from <a class="reference download internal" download="" href="_downloads/6a46aab03c39cbb5e27643cd5f30110c/test033.py"><code class="xref download docutils literal notranslate"><span class="pre">test033.py</span></code></a>.</p>
</section>
<section id="boolean-operations-on-meshes-with-plugin-meshboolean">
<h2><span class="section-number">6.17. </span>Boolean operations on meshes with plugin MeshBoolean<a class="headerlink" href="#boolean-operations-on-meshes-with-plugin-meshboolean" title="Permalink to this heading"></a></h2>
<p>The MeshBoolean plugin is described in the
<a class="reference external" href="http://www.cloudcompare.org/doc/wiki/index.php/Mesh_Boolean_(plugin)">CloudCompare Plugins wiki - Mesh_Bolean</a>.</p>
<p>This plugin can be used to perform Boolean operations on meshes (also called CSG = Constructive Solid Geometry).</p>
<dl class="simple">
<dt>In the example, we try an intersection of two primitives, a sphere and a cylinder,</dt><dd><p>with <a class="reference internal" href="MeshBoolean.html#cloudComPy.MeshBoolean.computeMeshBoolean" title="cloudComPy.MeshBoolean.computeMeshBoolean"><code class="xref py py-func docutils literal notranslate"><span class="pre">computeMeshBoolean()</span></code></a>.</p>
</dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">tr1</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccGLMatrix</span><span class="p">()</span>
<span class="n">tr1</span><span class="o">.</span><span class="n">initFromParameters</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
<span class="n">sphere</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccSphere</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">tr1</span><span class="p">,</span> <span class="s2">&quot;aSphere&quot;</span><span class="p">)</span>

<span class="n">cylinder</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccCylinder</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)</span>

<span class="k">if</span> <span class="n">cc</span><span class="o">.</span><span class="n">isPluginMeshBoolean</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">cloudComPy.MeshBoolean</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">MeshBoolean</span><span class="o">.</span><span class="n">computeMeshBoolean</span><span class="p">(</span><span class="n">sphere</span><span class="p">,</span> <span class="n">cylinder</span><span class="p">,</span> 
                                             <span class="n">cc</span><span class="o">.</span><span class="n">MeshBoolean</span><span class="o">.</span><span class="n">CSG_OPERATION</span><span class="o">.</span><span class="n">INTERSECT</span><span class="p">)</span>
    
</pre></div>
</div>
<p>The above code snippet is from <a class="reference download internal" download="" href="_downloads/be2bbd92ddacbf9c677b09b51859836c/test034.py"><code class="xref download docutils literal notranslate"><span class="pre">test034.py</span></code></a>.</p>
</section>
<section id="finding-primitives-on-a-cloud-with-plugin-ransac-sd">
<h2><span class="section-number">6.18. </span>Finding primitives on a cloud with plugin RANSAC-SD<a class="headerlink" href="#finding-primitives-on-a-cloud-with-plugin-ransac-sd" title="Permalink to this heading"></a></h2>
<p>The RANSAC-SD plugin is documented in the
<a class="reference external" href="https://www.cloudcompare.org/doc/wiki/index.php/RANSAC_Shape_Detection_(plugin)">CloudCompare Plugins wiki - RANSAC Shape Detection</a>.</p>
<p>The RANSAC-SD plugin (RANdom SAmple Consensus) is used to detect simple shapes
(planes, spheres, cylinders, cones, torus) in a cloud.</p>
<p>You have to import the The <a class="reference internal" href="RANSAC_SD.html#module-cloudComPy.RANSAC_SD" title="cloudComPy.RANSAC_SD"><code class="xref py py-mod docutils literal notranslate"><span class="pre">RANSAC_SD</span></code></a> plugin.</p>
<p>The <a class="reference internal" href="RANSAC_SD.html#cloudComPy.RANSAC_SD.computeRANSAC_SD" title="cloudComPy.RANSAC_SD.computeRANSAC_SD"><code class="xref py py-func docutils literal notranslate"><span class="pre">computeRANSAC_SD()</span></code></a> function
requires a set of parameters: <a class="reference internal" href="RANSAC_SD.html#cloudComPy.RANSAC_SD.RansacParams" title="cloudComPy.RANSAC_SD.RansacParams"><code class="xref py py-class docutils literal notranslate"><span class="pre">RansacParams</span></code></a>.</p>
<p>The <a class="reference internal" href="RANSAC_SD.html#cloudComPy.RANSAC_SD.RansacParams.optimizeForCloud" title="cloudComPy.RANSAC_SD.RansacParams.optimizeForCloud"><code class="xref py py-meth docutils literal notranslate"><span class="pre">optimizeForCloud()</span></code></a> method helps to get a correct set of parameters.
By default, the algorithm searchs only planes, spheres and cylinders,
you can enable or disable a primitive type with  <code class="docutils literal notranslate"><span class="pre">setPrimEnabled</span></code>.</p>
<p>For the example we regroup 4 clouds (samples from 3 spheres and 1 cylinder) in a single cloud.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">tr0</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccGLMatrix</span><span class="p">()</span>
<span class="n">tr0</span><span class="o">.</span><span class="n">initFromParameters</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">))</span>
<span class="n">cylinder</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccCylinder</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">tr0</span><span class="p">)</span>
<span class="n">c0</span> <span class="o">=</span> <span class="n">cylinder</span><span class="o">.</span><span class="n">samplePoints</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="n">tr1</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccGLMatrix</span><span class="p">()</span>
<span class="n">tr1</span><span class="o">.</span><span class="n">initFromParameters</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
<span class="n">sphere1</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccSphere</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">tr1</span><span class="p">)</span>
<span class="n">c1</span> <span class="o">=</span> <span class="n">sphere1</span><span class="o">.</span><span class="n">samplePoints</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="n">tr2</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccGLMatrix</span><span class="p">()</span>
<span class="n">tr2</span><span class="o">.</span><span class="n">initFromParameters</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">6.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">))</span>
<span class="n">sphere2</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccSphere</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">tr2</span><span class="p">)</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">sphere2</span><span class="o">.</span><span class="n">samplePoints</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="n">tr3</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccGLMatrix</span><span class="p">()</span>
<span class="n">tr3</span><span class="o">.</span><span class="n">initFromParameters</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">))</span>
<span class="n">sphere3</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccSphere</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">tr3</span><span class="p">)</span>
<span class="n">c3</span> <span class="o">=</span> <span class="n">sphere3</span><span class="o">.</span><span class="n">samplePoints</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="n">cloud</span> <span class="o">=</span> <span class="n">c0</span><span class="o">.</span><span class="n">cloneThis</span><span class="p">()</span>
<span class="n">cloud</span><span class="o">.</span><span class="n">fuse</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>
<span class="n">cloud</span><span class="o">.</span><span class="n">fuse</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
<span class="n">cloud</span><span class="o">.</span><span class="n">fuse</span><span class="p">(</span><span class="n">c3</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="RANSAC_SD.html#cloudComPy.RANSAC_SD.computeRANSAC_SD" title="cloudComPy.RANSAC_SD.computeRANSAC_SD"><code class="xref py py-func docutils literal notranslate"><span class="pre">computeRANSAC_SD()</span></code></a> function returns a list of meshes and clouds for the shapes found.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="k">if</span> <span class="n">cc</span><span class="o">.</span><span class="n">isPluginRANSAC_SD</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">cloudComPy.RANSAC_SD</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">RANSAC_SD</span><span class="o">.</span><span class="n">RansacParams</span><span class="p">()</span>
    <span class="n">params</span><span class="o">.</span><span class="n">optimizeForCloud</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">bitmapEpsilon</span><span class="p">)</span>
    <span class="n">meshes</span><span class="p">,</span> <span class="n">clouds</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">RANSAC_SD</span><span class="o">.</span><span class="n">computeRANSAC_SD</span><span class="p">(</span><span class="n">cloud</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    
</pre></div>
</div>
<p>For each type of primitive (plane, sphere, cylinder,..) it is possible to get the parameters of the equation.
For instance, a plane is identified with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mesh</span><span class="o">.</span><span class="n">isA</span><span class="p">((</span><span class="n">cc</span><span class="o">.</span><span class="n">CC_TYPES</span><span class="o">.</span><span class="n">PLANE</span><span class="p">)</span>
</pre></div>
</div>
<p>For the plane primitive, the method <a class="reference internal" href="ccPrimitives.html#cloudComPy.ccPlane.getEquation" title="cloudComPy.ccPlane.getEquation"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getEquation()</span></code></a> returns the 4 coefficients of the plane equation: [a, b, c, d] as ax+by+cz=d</p>
<p>The above code snippets are from <a class="reference download internal" download="" href="_downloads/c5f1ac3d6f90330f4659d956fb37657b/test035.py"><code class="xref download docutils literal notranslate"><span class="pre">test035.py</span></code></a>.</p>
</section>
<section id="compute-cloth-simulation-filter-on-a-cloud-with-csf-plugin">
<h2><span class="section-number">6.19. </span>compute Cloth Simulation Filter on a cloud with CSF plugin<a class="headerlink" href="#compute-cloth-simulation-filter-on-a-cloud-with-csf-plugin" title="Permalink to this heading"></a></h2>
<p>The concepts are presented in the
<a class="reference external" href="https://www.cloudcompare.org/doc/wiki/index.php/CSF_(plugin)">CloudCompare wiki - CSF (plugin)</a>.</p>
<p>You have to import the The <a class="reference internal" href="CSF.html#module-cloudComPy.CSF" title="cloudComPy.CSF"><code class="xref py py-mod docutils literal notranslate"><span class="pre">CSF</span></code></a> plugin.</p>
<p>The <a class="reference internal" href="CSF.html#cloudComPy.CSF.computeCSF" title="cloudComPy.CSF.computeCSF"><code class="xref py py-func docutils literal notranslate"><span class="pre">computeCSF()</span></code></a> function takes a ccPointCloud in input and several optional parameters.
The function produce two clouds: “ground points” and “off-ground points”.</p>
<p>A first example with default parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="k">if</span> <span class="n">cc</span><span class="o">.</span><span class="n">isPluginCSF</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">cloudComPy.CSF</span>
    <span class="n">cloud</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">loadPointCloud</span><span class="p">(</span><span class="n">getSampleCloud</span><span class="p">(</span><span class="mf">5.0</span><span class="p">))</span>
    <span class="n">clouds</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">CSF</span><span class="o">.</span><span class="n">computeCSF</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
    
</pre></div>
</div>
<p>And a second example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
    <span class="n">clouds2</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">CSF</span><span class="o">.</span><span class="n">computeCSF</span><span class="p">(</span><span class="n">cloud</span><span class="p">,</span> <span class="n">csfRigidness</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">clothResolution</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">classThreshold</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    
</pre></div>
</div>
<p>The above code snippets are from <a class="reference download internal" download="" href="_downloads/b093c7b076a4fe7ee71a804f267c3b91/test043.py"><code class="xref download docutils literal notranslate"><span class="pre">test043.py</span></code></a>.</p>
</section>
<section id="sclices-and-contours">
<h2><span class="section-number">6.20. </span>Sclices and contours<a class="headerlink" href="#sclices-and-contours" title="Permalink to this heading"></a></h2>
<p>The concepts are presented in the
<a class="reference external" href="https://www.cloudcompare.org/doc/wiki/index.php/Cross_Section">CloudCompare wiki - Cross Section</a>.</p>
<p>Given a bounding box used as a cut tool, and a list of entities to sclice (clouds and meshes),
the <a class="reference internal" href="cloudComPy.html#cloudComPy.ExtractSlicesAndContours" title="cloudComPy.ExtractSlicesAndContours"><code class="xref py py-func docutils literal notranslate"><span class="pre">ExtractSlicesAndContours()</span></code></a> function allows to:</p>
<blockquote>
<div><ul class="simple">
<li><p>segment the entities (slice)</p></li>
<li><p>extract the envelope of all the points inside the slice</p></li>
<li><p>extract one or several contours of the points inside each slice</p></li>
<li><p>repeat the segmentation or extraction processes above along one or several dimensions
(to extract multiple ‘slices’ for instances)</p></li>
</ul>
</div></blockquote>
<p>For the example, we create a list of objects to slice, one cloud and two meshes.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">tr1</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccGLMatrix</span><span class="p">()</span>
<span class="n">tr1</span><span class="o">.</span><span class="n">initFromParameters</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
<span class="n">sphere1</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccSphere</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">tr1</span><span class="p">)</span>
<span class="n">c1</span> <span class="o">=</span> <span class="n">sphere1</span><span class="o">.</span><span class="n">samplePoints</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="n">tr2</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccGLMatrix</span><span class="p">()</span>
<span class="n">tr2</span><span class="o">.</span><span class="n">initFromParameters</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
<span class="n">sphere2</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccSphere</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">tr2</span><span class="p">)</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">sphere2</span><span class="o">.</span><span class="n">samplePoints</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="n">cloud</span> <span class="o">=</span> <span class="n">c1</span><span class="o">.</span><span class="n">cloneThis</span><span class="p">()</span>
<span class="n">cloud</span><span class="o">.</span><span class="n">fuse</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>

<span class="n">toslice</span> <span class="o">=</span> <span class="p">[</span><span class="n">cloud</span><span class="p">,</span> <span class="n">sphere1</span><span class="p">,</span> <span class="n">sphere2</span><span class="p">]</span> <span class="c1"># one cloud, two meshes</span>
</pre></div>
</div>
<p>We define a bounding box as a cutting tool:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">bbox</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccBBox</span><span class="p">((</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">5.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>First, generate a single slice: the function returns a list containing a single slice</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">res</span><span class="o">=</span><span class="n">cc</span><span class="o">.</span><span class="n">ExtractSlicesAndContours</span><span class="p">(</span><span class="n">entities</span><span class="o">=</span><span class="n">toslice</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">bbox</span><span class="p">)</span>
</pre></div>
</div>
<p>then, repeat the slices along Z with a gap: the function returns a list containing several slices</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">res</span><span class="o">=</span><span class="n">cc</span><span class="o">.</span><span class="n">ExtractSlicesAndContours</span><span class="p">(</span><span class="n">entities</span><span class="o">=</span><span class="n">toslice</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">bbox</span><span class="p">,</span> <span class="n">singleSliceMode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                <span class="n">gap</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">generateRandomColors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>next, the same as above, plus envelopes:
the function returns a tuple(list of slices, list of envelopes)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">res</span><span class="o">=</span><span class="n">cc</span><span class="o">.</span><span class="n">ExtractSlicesAndContours</span><span class="p">(</span><span class="n">entities</span><span class="o">=</span><span class="n">toslice</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">bbox</span><span class="p">,</span> <span class="n">singleSliceMode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                <span class="n">gap</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">generateRandomColors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                <span class="n">extractEnvelopes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">maxEdgeLength</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">envelopeType</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>after, the same as above, with a rotation of the bounding box:
the function returns a tuple(list of slices, list of envelopes)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">tr0</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccGLMatrix</span><span class="p">()</span>
<span class="n">tr0</span><span class="o">.</span><span class="n">initFromParameters</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">12.</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
<span class="n">res</span><span class="o">=</span><span class="n">cc</span><span class="o">.</span><span class="n">ExtractSlicesAndContours</span><span class="p">(</span><span class="n">entities</span><span class="o">=</span><span class="n">toslice</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">bbox</span><span class="p">,</span> <span class="n">bboxTrans</span><span class="o">=</span><span class="n">tr0</span><span class="p">,</span> 
                                <span class="n">singleSliceMode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gap</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">generateRandomColors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                <span class="n">extractEnvelopes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">maxEdgeLength</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">envelopeType</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>finally, the same as above, plus contours:
the function returns a tuple(list of slices, list of envelopes, list of contours)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">res</span><span class="o">=</span><span class="n">cc</span><span class="o">.</span><span class="n">ExtractSlicesAndContours</span><span class="p">(</span><span class="n">entities</span><span class="o">=</span><span class="n">toslice</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">bbox</span><span class="p">,</span> <span class="n">bboxTrans</span><span class="o">=</span><span class="n">tr0</span><span class="p">,</span> 
                                <span class="n">singleSliceMode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gap</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">generateRandomColors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                <span class="n">extractEnvelopes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">maxEdgeLength</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">envelopeType</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                <span class="n">extractLevelSet</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">levelSetGridStep</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> 
                                <span class="n">levelSetMinVertCount</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>The above code snippets are from <a class="reference download internal" download="" href="_downloads/da60574e736e09233eedd19f0a798752/test036.py"><code class="xref download docutils literal notranslate"><span class="pre">test036.py</span></code></a>.</p>
</section>
<section id="extractconnectedcomponents">
<h2><span class="section-number">6.21. </span>ExtractConnectedComponents<a class="headerlink" href="#extractconnectedcomponents" title="Permalink to this heading"></a></h2>
<p>The tool used here is described in
<a class="reference external" href="https://www.cloudcompare.org/doc/wiki/index.php/Label_Connected_Components">CloudCompare wiki - Label Connected Components</a>.</p>
<p>This tool segments the selected cloud(s) in smaller parts separated by a minimum distance.
Each part is a connected component (i.e. a set of ‘connected’ points).</p>
<p>For the test, we create a cloud with clear gaps, using a sclice operation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">cloud</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">loadPointCloud</span><span class="p">(</span><span class="n">getSampleCloud</span><span class="p">(</span><span class="mf">5.0</span><span class="p">))</span>
<span class="n">bbox</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccBBox</span><span class="p">((</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">5.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">res</span><span class="o">=</span><span class="n">cc</span><span class="o">.</span><span class="n">ExtractSlicesAndContours</span><span class="p">(</span><span class="n">entities</span><span class="o">=</span><span class="p">[</span><span class="n">cloud</span><span class="p">],</span> <span class="n">bbox</span><span class="o">=</span><span class="n">bbox</span><span class="p">)</span>
<span class="n">clouds</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># result = [one cloud]</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="cloudComPy.html#cloudComPy.ExtractConnectedComponents" title="cloudComPy.ExtractConnectedComponents"><code class="xref py py-func docutils literal notranslate"><span class="pre">ExtractConnectedComponents()</span></code></a> function use the octree level
to define the size of the gap between the components.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">res2</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ExtractConnectedComponents</span><span class="p">(</span><span class="n">clouds</span><span class="o">=</span><span class="n">clouds</span><span class="p">,</span> <span class="n">octreeLevel</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">randomColors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">components</span> <span class="o">=</span> <span class="n">res2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">components</span><span class="p">:</span>
    <span class="n">comp</span><span class="o">.</span><span class="n">showColors</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>The function returns a tuple (number of clouds processed, list of components)</p>
<p>The above code snippets are from <a class="reference download internal" download="" href="_downloads/5ea39b03e7b4ef5c8d38734aa8c49b5e/test037.py"><code class="xref download docutils literal notranslate"><span class="pre">test037.py</span></code></a>.</p>
</section>
<section id="avoid-memory-leaks-in-an-iterative-process">
<h2><span class="section-number">6.22. </span>Avoid memory leaks in an iterative process<a class="headerlink" href="#avoid-memory-leaks-in-an-iterative-process" title="Permalink to this heading"></a></h2>
<p>In a pure Python script, the garbage collector takes care of the objects that are no longer referenced.
With CloudComPy, there is no shared reference count between a CloudComPy Python object and the CloudCompare C++ object wrapped.
In other words, if a Python object is deleted, the wrapped C++ object remains.
Conversely, if a CloudCompare C++ object is deleted,
the corresponding Python object is not automatically deleted, but is no longer usable.</p>
<p>To avoid memory leaks, you should delete explicitely the objects that are no longer used with
the <a class="reference internal" href="cloudComPy.html#cloudComPy.deleteEntity" title="cloudComPy.deleteEntity"><code class="xref py py-func docutils literal notranslate"><span class="pre">cloudComPy.deleteEntity()</span></code></a> function.</p>
<p>For instance, we create some data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">process</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>
<span class="n">mem_start</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">memory_full_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span>
<span class="n">cloud</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">loadPointCloud</span><span class="p">(</span><span class="n">getSampleCloud</span><span class="p">(</span><span class="mf">5.0</span><span class="p">))</span>
<span class="n">bbox</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ccBBox</span><span class="p">((</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">5.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">res</span><span class="o">=</span><span class="n">cc</span><span class="o">.</span><span class="n">ExtractSlicesAndContours</span><span class="p">(</span><span class="n">entities</span><span class="o">=</span><span class="p">[</span><span class="n">cloud</span><span class="p">],</span> <span class="n">bbox</span><span class="o">=</span><span class="n">bbox</span><span class="p">)</span>
<span class="n">clouds</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;input data memory usage:&#39;</span><span class="p">,</span> <span class="n">process</span><span class="o">.</span><span class="n">memory_full_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span> <span class="o">-</span> <span class="n">mem_start</span><span class="p">)</span>
</pre></div>
</div>
<p>Then, we iterate on <a class="reference internal" href="cloudComPy.html#cloudComPy.ExtractConnectedComponents" title="cloudComPy.ExtractConnectedComponents"><code class="xref py py-func docutils literal notranslate"><span class="pre">ExtractConnectedComponents()</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">mem_start</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">memory_full_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span>
    <span class="n">res2</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">ExtractConnectedComponents</span><span class="p">(</span><span class="n">clouds</span><span class="o">=</span><span class="n">clouds</span><span class="p">,</span> <span class="n">octreeLevel</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">randomColors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">components</span> <span class="o">=</span> <span class="n">res2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">components</span><span class="p">:</span>
        <span class="n">comp</span><span class="o">.</span><span class="n">showColors</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    
</pre></div>
</div>
<p>I we do not delete explicitely the extracted components, they are kept forever in CloudCompare.
To avoid the memory leak:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
    <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">components</span><span class="p">:</span>
        <span class="n">cc</span><span class="o">.</span><span class="n">deleteEntity</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>
    <span class="c1"># be sure to have no more Python variable referencing the deleted items</span>
    <span class="n">components</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">res2</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">addedMemory</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">memory_full_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span> <span class="o">-</span> <span class="n">mem_start</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;iteration </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">, ExtractConnectedComponents added memory: &#39;</span><span class="p">,</span> <span class="n">addedMemory</span><span class="p">)</span>
    
</pre></div>
</div>
<p>The above code snippets are from <a class="reference download internal" download="" href="_downloads/4d1108c81d8dc847b8e47600acc95d56/test042.py"><code class="xref download docutils literal notranslate"><span class="pre">test042.py</span></code></a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="userNumpy.html" class="btn btn-neutral float-left" title="5. operations on coordinates, scalar fields, colors, meshes with Numpy" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="cloudComPy.html" class="btn btn-neutral float-right" title="1. cloudComPy module, functions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2022, Paul RASCLE.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>